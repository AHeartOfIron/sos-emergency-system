<!DOCTYPE html>
<!-- üÜò SOS Emergency System - –°–∏—Å—Ç–µ–º–∞ –µ–∫—Å—Ç—Ä–µ–Ω–æ–≥–æ —Ä–µ–∞–≥—É–≤–∞–Ω–Ω—è -->
<!-- –ì–æ–ª–æ–≤–Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞ –∑ —ñ–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—é –∫–∞—Ä—Ç–æ—é —Ç–∞ –ø–∞–Ω–µ–ª—è–º–∏ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è -->
<html lang="uk">
<head>
    <!-- –ë–∞–∑–æ–≤—ñ –º–µ—Ç–∞-—Ç–µ–≥–∏ –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üÜò SOS Emergency System</title>
    
    <!-- –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è —Ç—ñ–ª—å–∫–∏ –Ω–µ–æ–±—Ö—ñ–¥–Ω–∏—Ö –±—ñ–±–ª—ñ–æ—Ç–µ–∫ -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    
    <style>
        /* –ì–ª–æ–±–∞–ª—å–Ω—ñ —Å—Ç–∏–ª—ñ - —Å–∫–∏–¥–∞–Ω–Ω—è –≤—ñ–¥—Å—Ç—É–ø—ñ–≤ —Ç–∞ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è box-sizing */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* –°—Ç–∏–ª—ñ –¥–ª—è body - –∞–Ω—ñ–º–æ–≤–∞–Ω–∏–π –≥—Ä–∞–¥—ñ—î–Ω—Ç–Ω–∏–π —Ñ–æ–Ω */
        body {
            font-family: 'Rajdhani', sans-serif;                                    /* –û—Å–Ω–æ–≤–Ω–∏–π —à—Ä–∏—Ñ—Ç */
            background: linear-gradient(-45deg, #ffffff, #ffebee, #ffcdd2, #ef5350); /* –ì—Ä–∞–¥—ñ—î–Ω—Ç–Ω–∏–π —Ñ–æ–Ω */
            background-size: 400% 400%;                                              /* –†–æ–∑–º—ñ—Ä –¥–ª—è –∞–Ω—ñ–º–∞—Ü—ñ—ó */
            animation: gradientShift 15s ease infinite;                             /* –ê–Ω—ñ–º–∞—Ü—ñ—è –∑–º—ñ–Ω–∏ –∫–æ–ª—å–æ—Ä—ñ–≤ */
            overflow: hidden;                                                        /* –ü—Ä–∏—Ö–æ–≤—É—î–º–æ –ø—Ä–æ–∫—Ä—É—Ç–∫—É */
            height: 100vh;                                                           /* –í–∏—Å–æ—Ç–∞ –Ω–∞ –≤–µ—Å—å –µ–∫—Ä–∞–Ω */
            color: #000000;                                                          /* –ß–æ—Ä–Ω–∏–π —Ç–µ–∫—Å—Ç */
        }

        /* –ê–Ω—ñ–º–∞—Ü—ñ—è –∑–º—ñ—â–µ–Ω–Ω—è –≥—Ä–∞–¥—ñ—î–Ω—Ç–Ω–æ–≥–æ —Ñ–æ–Ω—É */
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }     /* –ü–æ—á–∞—Ç–∫–æ–≤–∞ –ø–æ–∑–∏—Ü—ñ—è */
            50% { background-position: 100% 50%; }  /* –°–µ—Ä–µ–¥–Ω—è –ø–æ–∑–∏—Ü—ñ—è */
            100% { background-position: 0% 50%; }   /* –ö—ñ–Ω—Ü–µ–≤–∞ –ø–æ–∑–∏—Ü—ñ—è */
        }

        /* –°—Ç–∏–ª—ñ –¥–ª—è –≥–æ–ª–æ–≤–Ω–æ—ó –∫–∞—Ä—Ç–∏ - –Ω–∞ –≤–µ—Å—å –µ–∫—Ä–∞–Ω */
        #map {
            width: 100vw;        /* –®–∏—Ä–∏–Ω–∞ –Ω–∞ –≤–µ—Å—å viewport */
            height: 100vh;       /* –í–∏—Å–æ—Ç–∞ –Ω–∞ –≤–µ—Å—å viewport */
            position: absolute;  /* –ê–±—Å–æ–ª—é—Ç–Ω–µ –ø–æ–∑–∏—Ü—ñ–æ–Ω—É–≤–∞–Ω–Ω—è */
            top: 0;             /* –ü—Ä–∏–∂–∞—Ç–æ –¥–æ –≤–µ—Ä—Ö—É */
            left: 0;            /* –ü—Ä–∏–∂–∞—Ç–æ –¥–æ –ª—ñ–≤–æ–≥–æ –∫—Ä–∞—é */
            z-index: 1;         /* –ù–∏–∂–Ω—ñ–π —à–∞—Ä */
        }

        /* –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –∑–ª—ñ–≤–∞ –∑–Ω–∏–∑—É */
        .control-panel {
            position: fixed;         /* –§—ñ–∫—Å–æ–≤–∞–Ω–µ –ø–æ–∑–∏—Ü—ñ–æ–Ω—É–≤–∞–Ω–Ω—è */
            bottom: 20px;           /* –í—ñ–¥—Å—Ç—É–ø –≤—ñ–¥ –Ω–∏–∑—É */
            left: 20px;             /* –í—ñ–¥—Å—Ç—É–ø –≤—ñ–¥ –ª—ñ–≤–æ–≥–æ –∫—Ä–∞—é */
            display: flex;          /* –§–ª–µ–∫—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä */
            flex-direction: column; /* –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–µ —Ä–æ–∑—Ç–∞—à—É–≤–∞–Ω–Ω—è */
            gap: 10px;              /* –ü—Ä–æ–º—ñ–∂–∫–∏ –º—ñ–∂ –µ–ª–µ–º–µ–Ω—Ç–∞–º–∏ */
            z-index: 1000;          /* –í–∏—Å–æ–∫–∏–π z-index */
        }

        /* –ü–∞–Ω–µ–ª—å SOS –ø–æ —Ü–µ–Ω—Ç—Ä—É –∑–Ω–∏–∑—É */
        .sos-panel {
            position: fixed;                /* –§—ñ–∫—Å–æ–≤–∞–Ω–µ –ø–æ–∑–∏—Ü—ñ–æ–Ω—É–≤–∞–Ω–Ω—è */
            bottom: 20px;                  /* –í—ñ–¥—Å—Ç—É–ø –≤—ñ–¥ –Ω–∏–∑—É */
            left: 50%;                     /* –ü–æ —Ü–µ–Ω—Ç—Ä—É –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ */
            transform: translateX(-50%);   /* –¶–µ–Ω—Ç—Ä—É–≤–∞–Ω–Ω—è —á–µ—Ä–µ–∑ transform */
            z-index: 1000;                 /* –í–∏—Å–æ–∫–∏–π z-index */
        }

        .control-btn {
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            padding: 12px 20px;
            font-family: 'Rajdhani', sans-serif;
            font-size: 14px;
            font-weight: 700;
            color: #000000;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            text-transform: uppercase;
            min-width: 120px;
            justify-content: center;
        }

        .control-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .control-btn.primary {
            background: #d32f2f;
            color: white;
            animation: pulseRed 2s ease-in-out infinite alternate;
        }

        .control-btn.primary:hover {
            animation: sosButtonHover 0.8s ease-in-out infinite;
            transform: translateY(-3px) scale(1.05);
        }

        @keyframes pulseRed {
            0% { box-shadow: 0 0 5px rgba(211, 47, 47, 0.5); }
            100% { box-shadow: 0 0 20px rgba(211, 47, 47, 0.8); }
        }

        @keyframes sosButtonHover {
            0%, 100% { 
                background: #d32f2f;
                box-shadow: 0 0 20px rgba(211, 47, 47, 0.8);
            }
            50% { 
                background: #ff1744;
                box-shadow: 0 0 30px rgba(255, 23, 68, 1), 0 0 50px rgba(255, 23, 68, 0.5);
            }
        }

        .control-btn.secondary {
            background: #1976d2;
            color: white;
        }

        .panel {
            position: fixed;
            background: rgba(255, 255, 255, 0.95);
            border: 2px solid rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            z-index: 9999;
            display: none;
            resize: both;
            overflow: auto;
            min-width: 300px;
            min-height: 200px;
        }

        .panel.active {
            display: block;
        }

        .panel-header {
            background: #d32f2f;
            color: white;
            padding: 10px 15px;
            border-radius: 8px 8px 0 0;
            cursor: move;
            display: flex;
            justify-content: space-between;
            align-items: center;
            user-select: none;
        }

        .panel-title {
            font-family: 'Rajdhani', sans-serif;
            font-size: 16px;
            font-weight: 700;
            color: white;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 18px;
            color: white;
            cursor: pointer;
            padding: 5px;
            border-radius: 3px;
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            background: rgba(255,255,255,0.2);
        }

        .panel-content {
            padding: 20px;
            max-height: 400px;
            overflow-y: auto;
            color: #000000;
        }

        #incidentsPanel {
            top: 100px;
            right: 50px;
            width: 400px;
            height: 500px;
        }

        .incident-card {
            background: white;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid #d32f2f;
        }

        .incident-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .incident-name {
            font-weight: 700;
            color: #000000;
            font-size: 18px;
        }

        .incident-time {
            font-family: 'Courier New', monospace;
            color: #d32f2f;
            font-weight: 700;
            font-size: 16px;
        }

        .incident-menu {
            display: flex;
            gap: 8px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 12px;
            border-radius: 5px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-primary { 
            background: #1976d2;
            color: white;
        }

        .btn-danger { 
            background: #d32f2f;
            color: white;
        }

        .btn-success { 
            background: #388e3c;
            color: white;
        }

        .btn-warning { 
            background: #f57c00;
            color: white;
        }

        .btn-sm:hover {
            transform: translateY(-1px);
            opacity: 0.9;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-label {
            display: block;
            margin-bottom: 5px;
            font-family: 'Rajdhani', sans-serif;
            font-weight: 600;
            color: #000000;
            font-size: 14px;
        }

        .form-control {
            width: 100%;
            padding: 8px 12px;
            background: white;
            border: 1px solid rgba(0, 0, 0, 0.2);
            border-radius: 5px;
            font-size: 14px;
            color: #000000;
            transition: all 0.3s ease;
            font-family: 'Rajdhani', sans-serif;
        }

        .form-control:focus {
            outline: none;
            border-color: #1976d2;
            box-shadow: 0 0 5px rgba(25, 118, 210, 0.3);
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
        }

        .group-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .group-card {
            background: white;
            border: 2px solid rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .group-card:hover {
            border-color: #1976d2;
            transform: translateY(-2px);
        }

        .group-card.selected {
            background: #1976d2;
            color: white;
            border-color: #1976d2;
        }

        .group-name {
            font-weight: 700;
            margin-bottom: 8px;
            font-size: 16px;
        }

        .group-info {
            font-size: 14px;
            opacity: 0.8;
        }

        .log-entry {
            background: white;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 5px;
            padding: 10px;
            margin-bottom: 8px;
            border-left: 3px solid #1976d2;
        }

        .log-time {
            font-size: 11px;
            color: #1976d2;
            margin-bottom: 4px;
        }

        .log-text {
            color: #000000;
            font-size: 14px;
        }

        .victim-list {
            max-height: 200px;
            overflow-y: auto;
            margin-bottom: 20px;
            background: white;
            border-radius: 8px;
            padding: 15px;
        }

        .victim-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: white;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 5px;
            margin-bottom: 8px;
        }

        .victim-name {
            font-weight: 700;
            color: #000000;
        }

        .victim-injury {
            font-size: 12px;
            color: #d32f2f;
        }

        .marker-group {
            width: 20px;
            height: 20px;
            background: #1976d2;
            border: 3px solid white;
            border-radius: 50%;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            animation: markerPulse 2s ease-in-out infinite alternate;
        }

        @keyframes markerPulse {
            0% { box-shadow: 0 2px 8px rgba(0,0,0,0.3); }
            100% { box-shadow: 0 0 15px rgba(25, 118, 210, 0.8); }
        }

        .marker-group.active {
            background: #d32f2f;
            animation: emergencyPulse 1s ease-in-out infinite;
        }

        @keyframes emergencyPulse {
            0%, 100% { 
                transform: scale(1);
                box-shadow: 0 0 10px rgba(211, 47, 47, 0.8);
            }
            50% { 
                transform: scale(1.2);
                box-shadow: 0 0 20px rgba(211, 47, 47, 1);
            }
        }

        .marker-hospital {
            width: 18px;
            height: 18px;
            background: #388e3c;
            border: 2px solid white;
            border-radius: 50%;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }

        .marker-sos {
            width: 30px;
            height: 30px;
            background: radial-gradient(circle, #ff1744, #d32f2f, #b71c1c);
            border: 3px solid white;
            border-radius: 50%;
            position: relative;
            animation: sosUltimatePulse 1s ease-in-out infinite;
            box-shadow: 
                0 0 0 0 rgba(255, 23, 68, 0.7),
                0 0 20px rgba(255, 23, 68, 0.8),
                inset 0 2px 4px rgba(255, 255, 255, 0.3);
        }

        .marker-sos::before {
            content: '‚úö';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 16px;
            font-weight: bold;
            color: white;
            text-shadow: 0 0 3px rgba(0,0,0,0.5);
            animation: sosTextPulse 0.5s ease-in-out infinite alternate;
        }

        .marker-sos::after {
            content: '';
            position: absolute;
            top: -5px;
            left: -5px;
            right: -5px;
            bottom: -5px;
            border: 2px solid rgba(255, 23, 68, 0.6);
            border-radius: 50%;
            animation: sosRingPulse 2s ease-out infinite;
        }

        @keyframes sosUltimatePulse {
            0%, 100% { 
                transform: scale(1);
                box-shadow: 
                    0 0 0 0 rgba(255, 23, 68, 0.7),
                    0 0 20px rgba(255, 23, 68, 0.8),
                    inset 0 2px 4px rgba(255, 255, 255, 0.3);
            }
            50% { 
                transform: scale(1.15);
                box-shadow: 
                    0 0 0 10px rgba(255, 23, 68, 0.3),
                    0 0 30px rgba(255, 23, 68, 1),
                    0 0 50px rgba(255, 23, 68, 0.5),
                    inset 0 2px 6px rgba(255, 255, 255, 0.4);
            }
        }

        @keyframes sosTextPulse {
            0% { opacity: 0.8; transform: translate(-50%, -50%) scale(0.9); }
            100% { opacity: 1; transform: translate(-50%, -50%) scale(1.1); }
        }

        @keyframes sosRingPulse {
            0% {
                transform: scale(1);
                opacity: 1;
                border-width: 2px;
            }
            50% {
                transform: scale(1.5);
                opacity: 0.5;
                border-width: 1px;
            }
            100% {
                transform: scale(2.5);
                opacity: 0;
                border-width: 0px;
            }
        }

        .wave {
            position: fixed;
            border: 4px solid #ff1744;
            border-radius: 50%;
            pointer-events: none;
            z-index: 500;
            animation: ultimateWaveExpand 4.6s ease-out forwards;
            box-shadow: 
                0 0 20px rgba(255, 23, 68, 0.8),
                inset 0 0 20px rgba(255, 23, 68, 0.3);
        }

        .wave::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            border: 2px solid rgba(255, 23, 68, 0.5);
            border-radius: 50%;
            animation: waveInner 4s ease-out forwards;
        }

        @keyframes ultimateWaveExpand {
            0% {
                width: 15px;
                height: 15px;
                opacity: 1;
                border-width: 4px;
                box-shadow: 
                    0 0 20px rgba(255, 23, 68, 0.8),
                    inset 0 0 20px rgba(255, 23, 68, 0.3);
            }
            25% {
                border-width: 3px;
                opacity: 0.8;
            }
            50% {
                border-width: 2px;
                opacity: 0.6;
            }
            75% {
                border-width: 1px;
                opacity: 0.3;
            }
            100% {
                width: 400px;
                height: 400px;
                opacity: 0;
                border-width: 0px;
                box-shadow: 
                    0 0 60px rgba(255, 23, 68, 0.2),
                    inset 0 0 60px rgba(255, 23, 68, 0.1);
            }
        }

        @keyframes waveInner {
            0% {
                opacity: 0.8;
                border-width: 2px;
            }
            50% {
                opacity: 0.4;
                border-width: 1px;
            }
            100% {
                opacity: 0;
                border-width: 0px;
            }
        }

        .notification {
            position: fixed;
            top: 30px;
            right: 30px;
            background: rgba(255, 255, 255, 0.95);
            border: 2px solid rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            padding: 15px 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            z-index: 10001;
            transform: translateX(120%);
            transition: all 0.4s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
            color: #000000;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            border-left: 4px solid #388e3c;
        }

        .notification.error {
            border-left: 4px solid #d32f2f;
        }

        .hidden { display: none !important; }

        /* –°—Ç–∏–ª—ñ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –∫–µ—Ä—É–≤–∞–Ω–Ω—è –ø–µ—Ä–µ—Ç—è–≥—É–≤–∞–Ω–Ω—è–º */
        .drag-enabled {
            cursor: move !important;
            opacity: 0.8;
            transition: opacity 0.3s ease;
        }
        
        .drag-enabled:hover {
            opacity: 1;
        }
        
        .drag-disabled {
            cursor: default !important;
            opacity: 1;
        }
        
        /* –ê–Ω—ñ–º–∞—Ü—ñ—è –¥–ª—è –º–∞—Ä–∫–µ—Ä—ñ–≤ –ø—Ä–∏ –ø–µ—Ä–µ—Ç—è–≥—É–≤–∞–Ω–Ω—ñ */
        .leaflet-marker-draggable {
            transition: transform 0.2s ease;
        }
        
        .leaflet-marker-draggable:hover {
            transform: scale(1.1);
        }



        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 10000;
            display: none;
        }

        .modal-overlay.active {
            display: block;
        }

        .modal-content {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 10px;
            padding: 20px;
            max-width: 600px;
            width: 90%;
            max-height: 85vh;
            overflow-y: auto;
            z-index: 10001;
        }

        .mini-map {
            width: 100%;
            height: 200px;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin: 10px 0;
        }

        .staff-list {
            max-height: 150px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 10px;
            margin: 10px 0;
        }

        .staff-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px;
            border-bottom: 1px solid #eee;
        }

        .staff-item:last-child {
            border-bottom: none;
        }

        .user-pin-marker {
            background: transparent !important;
            border: none !important;
        }

        .user-pin {
            position: relative;
            width: 20px;
            height: 30px;
            animation: userPinBounce 2s ease-in-out infinite;
        }

        .pin-head {
            width: 16px;
            height: 16px;
            background: linear-gradient(135deg, #e53e3e, #c53030, #9b2c2c);
            border: 2px solid white;
            border-radius: 50%;
            position: absolute;
            top: 0;
            left: 2px;
            box-shadow: 0 3px 8px rgba(229, 62, 62, 0.6);
        }

        .pin-head::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 6px;
            height: 6px;
            background: white;
            border-radius: 50%;
            box-shadow: 0 0 2px rgba(0,0,0,0.3);
        }

        .pin-tail {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 3px solid transparent;
            border-right: 3px solid transparent;
            border-top: 10px solid #c53030;
        }

        @keyframes userPinBounce {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-6px);
            }
        }
    </style>
</head>
<body>
    <div id="map"></div>
    
    <div class="control-panel">
        <button id="incidentsBtn" class="control-btn secondary hidden">
            <i class="fas fa-bell"></i>
            <span>–Ü–ù–¶–ò–î–ï–ù–¢–ò</span>
        </button>
        <button id="hospitalBtn" class="control-btn success">
            <i class="fas fa-hospital"></i>
            <span>–õ–Ü–ö–ê–†–ù–Ø</span>
        </button>
        <button id="groupBtn" class="control-btn warning">
            <i class="fas fa-users"></i>
            <span>–ì–†–£–ü–ò</span>
        </button>
        <button id="dataBtn" class="control-btn" style="background: #607D8B;">
            <i class="fas fa-database"></i>
            <span>–î–ê–ù–Ü</span>
        </button>
    </div>

    <div class="sos-panel">
        <button id="sosBtn" class="control-btn primary" style="font-size: 18px; padding: 20px 40px;">
            <i class="fas fa-exclamation-triangle"></i>
            <span>SOS</span>
        </button>
    </div>



    <!-- Incidents Panel -->
    <div id="incidentsPanel" class="panel">
        <div class="panel-header">
            <h3 class="panel-title">
                <i class="fas fa-exclamation-triangle"></i>
                –ê–∫—Ç–∏–≤–Ω—ñ —ñ–Ω—Ü–∏–¥–µ–Ω—Ç–∏
            </h3>
            <button class="close-btn" onclick="closeIncidentsPanel()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="panel-content">
            <div style="margin-bottom: 15px;">
                <button onclick="showAddGroupModal()" class="btn-sm btn-primary">
                    <i class="fas fa-plus"></i>
                    –î–æ–¥–∞—Ç–∏ –≥—Ä—É–ø—É
                </button>
                <button onclick="stopAllSOS()" class="btn-sm btn-danger" style="margin-left: 8px;">
                    <i class="fas fa-stop"></i>
                    –°—Ç–æ–ø –≤—Å–µ
                </button>
            </div>
            <div id="incidentsList"></div>
        </div>
    </div>

    <!-- Add Group Modal -->
    <div id="addGroupModal" class="modal-overlay">
        <div class="modal-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 1px solid #ddd;">
                <h3>–û–±–µ—Ä—ñ—Ç—å –≥—Ä—É–ø–∏ –¥–ª—è SOS</h3>
                <button class="close-btn" onclick="closeAddGroupModal()" style="color: #000;">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div id="groupGrid" class="group-grid"></div>
            <div style="display: flex; gap: 10px; justify-content: center; margin-top: 20px;">
                <button id="activateBtn" class="control-btn primary">
                    <i class="fas fa-play"></i>
                    –ê–ö–¢–ò–í–£–í–ê–¢–ò
                </button>
                <button class="control-btn" onclick="closeAddGroupModal()">
                    <i class="fas fa-times"></i>
                    –°–ö–ê–°–£–í–ê–¢–ò
                </button>
            </div>
        </div>
    </div>

    <!-- Logs Modal -->
    <div id="logsModal" class="modal-overlay">
        <div class="modal-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 1px solid #ddd;">
                <h3>–ñ—É—Ä–Ω–∞–ª –ø–æ–¥—ñ–π - <span id="logsIncidentName"></span></h3>
                <button class="close-btn" onclick="closeLogsModal()" style="color: #000;">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div id="logsContent" style="max-height: 300px; overflow-y: auto; margin-bottom: 15px;"></div>
            <div style="display: flex; gap: 8px;">
                <input type="text" id="logInput" placeholder="–î–æ–¥–∞—Ç–∏ –∑–∞–ø–∏—Å..." maxlength="100" style="flex: 1; padding: 8px; border: 1px solid #ddd; border-radius: 5px;">
                <button onclick="addLog()" class="btn-sm btn-primary">
                    <i class="fas fa-plus"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Hospital Modal -->
    <div id="hospitalModal" class="modal-overlay">
        <div class="modal-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 1px solid #ddd;">
                <h3>–î–æ–¥–∞—Ç–∏ –ª—ñ–∫–∞—Ä–Ω—é</h3>
                <button class="close-btn" onclick="closeHospitalModal()" style="color: #000;">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <form id="hospitalForm">
                <div class="form-group">
                    <label class="form-label">–ù–∞–∑–≤–∞ –ª—ñ–∫–∞—Ä–Ω—ñ</label>
                    <input type="text" id="hospitalName" class="form-control" maxlength="100" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">–ê–¥—Ä–µ—Å–∞</label>
                    <input type="text" id="hospitalAddress" class="form-control" maxlength="200" required>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">–ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞ –æ—Å–æ–±–∞</label>
                        <input type="text" id="contactPerson" class="form-control" maxlength="100">
                    </div>
                    <div class="form-group">
                        <label class="form-label">–¢–µ–ª–µ—Ñ–æ–Ω –ø—Ä–∏–π–º–∞–ª—å–Ω–æ–≥–æ</label>
                        <input type="tel" id="emergencyPhone" class="form-control" maxlength="20">
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ (–∫–ª—ñ–∫–Ω—ñ—Ç—å –Ω–∞ –∫–∞—Ä—Ç—ñ –∞–±–æ –≤–≤–µ–¥—ñ—Ç—å –≤—Ä—É—á–Ω—É)</label>
                    <div id="miniMap" class="mini-map"></div>
                    <div style="display: flex; gap: 10px; margin-top: 5px;">
                        <input type="number" id="hospitalLat" class="form-control" placeholder="–®–∏—Ä–æ—Ç–∞" step="any">
                        <input type="number" id="hospitalLng" class="form-control" placeholder="–î–æ–≤–≥–æ—Ç–∞" step="any">
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">–ú–µ–¥–ø–µ—Ä—Å–æ–Ω–∞–ª</label>
                    <div style="display: flex; gap: 8px; margin-bottom: 10px;">
                        <input type="text" id="staffName" class="form-control" placeholder="–ü–Ü–ë" style="flex: 2;">
                        <input type="text" id="staffPosition" class="form-control" placeholder="–ü–æ—Å–∞–¥–∞" style="flex: 1;">
                        <input type="text" id="staffSchedule" class="form-control" placeholder="–ì—Ä–∞—Ñ—ñ–∫" style="flex: 1;">
                        <input type="tel" id="staffPhone" class="form-control" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω" style="flex: 1;">
                        <button type="button" onclick="addStaff()" class="btn-sm btn-primary">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                    <div id="staffList" class="staff-list"></div>
                </div>
                
                <div style="display: flex; gap: 8px; justify-content: center; margin-top: 20px;">
                    <button type="button" id="saveHospitalBtn" class="control-btn success">
                        <i class="fas fa-save"></i>
                        –ó–ë–ï–†–ï–ì–¢–ò
                    </button>
                    <button type="button" onclick="clearHospitalForm()" class="control-btn">
                        <i class="fas fa-eraser"></i>
                        –û–ß–ò–°–¢–ò–¢–ò
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Group Modal -->
    <div id="groupModal" class="modal-overlay">
        <div class="modal-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 1px solid #ddd;">
                <h3>–î–æ–¥–∞—Ç–∏ –≥—Ä—É–ø—É</h3>
                <button class="close-btn" onclick="closeGroupModal()" style="color: #000;">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <form id="groupForm">
                <div class="form-group">
                    <label class="form-label">–ù–∞–∑–≤–∞ –≥—Ä—É–ø–∏</label>
                    <input type="text" id="groupName" class="form-control" maxlength="50" required>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">–¢–∏–ø –≥—Ä—É–ø–∏</label>
                        <select id="groupType" class="form-control">
                            <option value="–ù–¢–û">–ù–¢–û</option>
                            <option value="–†–æ–∑–º—ñ–Ω—É–≤–∞–Ω–Ω—è">–†–æ–∑–º—ñ–Ω—É–≤–∞–Ω–Ω—è</option>
                            <option value="–Ü–ù–†–ú">–Ü–ù–†–ú</option>
                            <option value="–¢–û">–¢–û</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">–û—Å–æ–±–æ–≤–∏–π —Å–∫–ª–∞–¥</label>
                        <input type="number" id="groupPersonnel" class="form-control" min="1" max="20" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ (–∫–ª—ñ–∫–Ω—ñ—Ç—å –Ω–∞ –∫–∞—Ä—Ç—ñ –∞–±–æ –≤–≤–µ–¥—ñ—Ç—å –≤—Ä—É—á–Ω—É)</label>
                    <div id="groupMiniMap" class="mini-map"></div>
                    <div style="display: flex; gap: 10px; margin-top: 5px;">
                        <input type="number" id="groupLat" class="form-control" placeholder="–®–∏—Ä–æ—Ç–∞" step="any">
                        <input type="number" id="groupLng" class="form-control" placeholder="–î–æ–≤–≥–æ—Ç–∞" step="any">
                    </div>
                </div>
                
                <div style="display: flex; gap: 8px; justify-content: center; margin-top: 20px;">
                    <button type="button" id="saveGroupBtn" class="control-btn primary">
                        <i class="fas fa-save"></i>
                        –ó–ë–ï–†–ï–ì–¢–ò
                    </button>
                    <button type="button" onclick="clearGroupForm()" class="control-btn">
                        <i class="fas fa-eraser"></i>
                        –û–ß–ò–°–¢–ò–¢–ò
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Victim Modal -->
    <div id="victimModal" class="modal-overlay">
        <div class="modal-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 1px solid #ddd;">
                <h3>–ö–∞—Ä—Ç–∫–∞ –ø–æ—Å—Ç—Ä–∞–∂–¥–∞–ª–æ–≥–æ - <span id="victimIncidentName"></span></h3>
                <button class="close-btn" onclick="closeVictimModal()" style="color: #000;">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div id="victimList" class="victim-list"></div>
            
            <form id="victimForm">
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">–ü–Ü–ë</label>
                        <input type="text" id="victimName" class="form-control" maxlength="50">
                    </div>
                    <div class="form-group">
                        <label class="form-label">–í—ñ–∫</label>
                        <input type="number" id="victimAge" class="form-control" min="1" max="120">
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">–¢–∏–ø —Ç—Ä–∞–≤–º–∏</label>
                    <select id="injuryType" class="form-control">
                        <option value="">–û–±–µ—Ä—ñ—Ç—å —Ç–∏–ø —Ç—Ä–∞–≤–º–∏</option>
                        <option value="–ú—ñ–Ω–Ω–∞ —Ç—Ä–∞–≤–º–∞">–ú—ñ–Ω–Ω–∞ —Ç—Ä–∞–≤–º–∞</option>
                        <option value="–û—Å–∫–æ–ª–∫–æ–≤–µ –ø–æ—Ä–∞–Ω–µ–Ω–Ω—è">–û—Å–∫–æ–ª–∫–æ–≤–µ –ø–æ—Ä–∞–Ω–µ–Ω–Ω—è</option>
                        <option value="–û–ø—ñ–∫ I —Å—Ç—É–ø–µ–Ω—è">–û–ø—ñ–∫ I —Å—Ç—É–ø–µ–Ω—è</option>
                        <option value="–û–ø—ñ–∫ II —Å—Ç—É–ø–µ–Ω—è">–û–ø—ñ–∫ II —Å—Ç—É–ø–µ–Ω—è</option>
                        <option value="–û–ø—ñ–∫ III —Å—Ç—É–ø–µ–Ω—è">–û–ø—ñ–∫ III —Å—Ç—É–ø–µ–Ω—è</option>
                        <option value="–ü–µ—Ä–µ–ª–æ–º –≤—ñ–¥–∫—Ä–∏—Ç–∏–π">–ü–µ—Ä–µ–ª–æ–º –≤—ñ–¥–∫—Ä–∏—Ç–∏–π</option>
                        <option value="–ü–µ—Ä–µ–ª–æ–º –∑–∞–∫—Ä–∏—Ç–∏–π">–ü–µ—Ä–µ–ª–æ–º –∑–∞–∫—Ä–∏—Ç–∏–π</option>
                        <option value="–ß–ú–¢ (–ª–µ–≥–∫–∞)">–ß–ú–¢ (–ª–µ–≥–∫–∞)</option>
                        <option value="–ß–ú–¢ (—Å–µ—Ä–µ–¥–Ω—è)">–ß–ú–¢ (—Å–µ—Ä–µ–¥–Ω—è)</option>
                        <option value="–ß–ú–¢ (—Ç—è–∂–∫–∞)">–ß–ú–¢ (—Ç—è–∂–∫–∞)</option>
                        <option value="–ö—Ä–æ–≤–æ—Ç–µ—á–∞ –∑–æ–≤–Ω—ñ—à–Ω—è">–ö—Ä–æ–≤–æ—Ç–µ—á–∞ –∑–æ–≤–Ω—ñ—à–Ω—è</option>
                        <option value="–ö—Ä–æ–≤–æ—Ç–µ—á–∞ –≤–Ω—É—Ç—Ä—ñ—à–Ω—è">–ö—Ä–æ–≤–æ—Ç–µ—á–∞ –≤–Ω—É—Ç—Ä—ñ—à–Ω—è</option>
                        <option value="–®–æ–∫ —Ç—Ä–∞–≤–º–∞—Ç–∏—á–Ω–∏–π">–®–æ–∫ —Ç—Ä–∞–≤–º–∞—Ç–∏—á–Ω–∏–π</option>
                        <option value="–ü–Ω–µ–≤–º–æ—Ç–æ—Ä–∞–∫—Å">–ü–Ω–µ–≤–º–æ—Ç–æ—Ä–∞–∫—Å</option>
                        <option value="–û—Ç—Ä—É—î–Ω–Ω—è">–û—Ç—Ä—É—î–Ω–Ω—è</option>
                    </select>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">–ü—É–ª—å—Å (—É–¥/—Ö–≤)</label>
                        <input type="number" id="pulse" class="form-control" min="40" max="200">
                    </div>
                    <div class="form-group">
                        <label class="form-label">–î–∏—Ö–∞–Ω–Ω—è (—Ä–∞–∑/—Ö–≤)</label>
                        <input type="number" id="breathing" class="form-control" min="10" max="40">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">–ê—Ä—Ç–µ—Ä—ñ–∞–ª—å–Ω–∏–π —Ç–∏—Å–∫</label>
                        <input type="text" id="bloodPressure" class="form-control" placeholder="120/80">
                    </div>
                    <div class="form-group">
                        <label class="form-label">–¢—É—Ä–Ω—ñ–∫–µ—Ç</label>
                        <select id="tourniquet" class="form-control">
                            <option value="">–ù–µ –∑–∞—Å—Ç–æ—Å–æ–≤–∞–Ω–æ</option>
                            <option value="–ù–∞–∫–ª–∞–¥–µ–Ω–æ">–ù–∞–∫–ª–∞–¥–µ–Ω–æ</option>
                            <option value="–ü–æ—Ç—Ä—ñ–±–µ–Ω">–ü–æ—Ç—Ä—ñ–±–µ–Ω</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">–û–ø–∏—Å —Ç—Ä–∞–≤–º</label>
                    <textarea id="injuryDescription" class="form-control" rows="2" maxlength="200"></textarea>
                </div>
                
                <div style="display: flex; gap: 8px; justify-content: center; margin-top: 15px;">
                    <button type="button" id="saveVictimBtn" class="control-btn primary">
                        <i class="fas fa-save"></i>
                        –ó–ë–ï–†–ï–ì–¢–ò
                    </button>
                    <button type="button" onclick="clearVictimForm()" class="control-btn">
                        <i class="fas fa-eraser"></i>
                        –û–ß–ò–°–¢–ò–¢–ò
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.js"></script>
    
    <script>
        // üÜò SOS Emergency System - –°–∏—Å—Ç–µ–º–∞ –µ–∫—Å—Ç—Ä–µ–Ω–æ–≥–æ —Ä–µ–∞–≥—É–≤–∞–Ω–Ω—è
        // –ê–≤—Ç–æ—Ä: by Illia Usachov
        
        class SOSSystem {
            constructor() {
                // –û—Å–Ω–æ–≤–Ω—ñ –∑–º—ñ–Ω–Ω—ñ —Å–∏—Å—Ç–µ–º–∏
                this.map = null;                    // –ì–æ–ª–æ–≤–Ω–∞ –∫–∞—Ä—Ç–∞ Leaflet
                this.isActive = false;              // –°—Ç–∞—Ç—É—Å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ SOS —Ä–µ–∂–∏–º—É
                this.selectedGroups = [];           // –û–±—Ä–∞–Ω—ñ –≥—Ä—É–ø–∏ –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü—ñ—ó
                this.activeIncidents = [];          // –ê–∫—Ç–∏–≤–Ω—ñ —ñ–Ω—Ü–∏–¥–µ–Ω—Ç–∏
                this.incidentVictims = {};          // –ö–∞—Ä—Ç–∫–∏ –ø–æ—Å—Ç—Ä–∞–∂–¥–∞–ª–∏—Ö –ø–æ —ñ–Ω—Ü–∏–¥–µ–Ω—Ç–∞—Ö
                this.incidentLogs = {};             // –ñ—É—Ä–Ω–∞–ª–∏ –ø–æ–¥—ñ–π –ø–æ —ñ–Ω—Ü–∏–¥–µ–Ω—Ç–∞—Ö
                this.groups = [];                            // –ì—Ä—É–ø–∏ (–∑–∞–≤–∞–Ω—Ç–∞–∂—É—é—Ç—å—Å—è –∑ JSON)
                this.hospitals = [];                         // –õ—ñ–∫–∞—Ä–Ω—ñ (–∑–∞–≤–∞–Ω—Ç–∞–∂—É—é—Ç—å—Å—è –∑ JSON)
                this.groupMarkers = [];             // –ú–∞—Ä–∫–µ—Ä–∏ –≥—Ä—É–ø –Ω–∞ –∫–∞—Ä—Ç—ñ
                this.sosMarker = null;              // SOS –º–∞—Ä–∫–µ—Ä (–∑–∞—Å—Ç–∞—Ä—ñ–ª–∏–π)
                this.sosMarkers = [];               // –ú–∞—Å–∏–≤ SOS –º–∞—Ä–∫–µ—Ä—ñ–≤
                this.routeControls = [];            // –ö–æ–Ω—Ç—Ä–æ–ª–∏ –º–∞—Ä—à—Ä—É—Ç—ñ–≤
                this.waveInterval = null;           // –Ü–Ω—Ç–µ—Ä–≤–∞–ª –∞–Ω—ñ–º–∞—Ü—ñ—ó —Ö–≤–∏–ª—å
                this.alertInterval = null;          // –Ü–Ω—Ç–µ—Ä–≤–∞–ª –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Ç–∞–π–º–µ—Ä—ñ–≤
                this.currentIncidentId = null;      // ID –ø–æ—Ç–æ—á–Ω–æ–≥–æ —ñ–Ω—Ü–∏–¥–µ–Ω—Ç—É
                this.hospitalStaff = [];            // –¢–∏–º—á–∞—Å–æ–≤–∏–π —Å–ø–∏—Å–æ–∫ –ø–µ—Ä—Å–æ–Ω–∞–ª—É –ª—ñ–∫–∞—Ä–Ω—ñ
                this.miniMap = null;                // –ú—ñ–Ω—ñ–∫–∞—Ä—Ç–∞ –¥–ª—è –≤–∏–±–æ—Ä—É –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
                this.selectedCoords = null;         // –û–±—Ä–∞–Ω—ñ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏
                this.userLocation = null;           // –ú—ñ—Å—Ü–µ–∑–Ω–∞—Ö–æ–¥–∂–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
                // init() –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è –æ–∫—Ä–µ–º–æ –≤ DOMContentLoaded
            }
            
            async init() {
                // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –≤—Å—ñ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ–≤ —Å–∏—Å—Ç–µ–º–∏
                this.initMap();                     // –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–∞—Ä—Ç–∏
                await this.loadLocations();         // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ª–æ–∫–∞—Ü—ñ–π –∑ JSON
                this.bindEvents();                  // –ü—Ä–∏–≤'—è–∑–∫–∞ –ø–æ–¥—ñ–π –¥–æ –∫–Ω–æ–ø–æ–∫
                this.addGroupMarkers();             // –î–æ–¥–∞–≤–∞–Ω–Ω—è –º–∞—Ä–∫–µ—Ä—ñ–≤ –≥—Ä—É–ø
                this.addHospitalMarkers();          // –î–æ–¥–∞–≤–∞–Ω–Ω—è –º–∞—Ä–∫–µ—Ä—ñ–≤ –ª—ñ–∫–∞—Ä–µ–Ω—å
                this.makePanelsDraggable();         // –†–æ–±–∏–º–æ –ø–∞–Ω–µ–ª—ñ –ø–µ—Ä–µ—Ç—è–≥—É–≤–∞–Ω–∏–º–∏
                this.getUserLocation();             // –û—Ç—Ä–∏–º–∞–Ω–Ω—è –≥–µ–æ–ª–æ–∫–∞—Ü—ñ—ó –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
                this.initScaleBar();                // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –º–∞—Å—à—Ç–∞–±–Ω–æ—ó –ª—ñ–Ω—ñ–π–∫–∏
            }
            
            initMap() {
                // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –∫–∞—Ä—Ç–∏ Leaflet
                console.log('Initializing map...');
                try {
                    // –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∫–∞—Ä—Ç–∏ –∑ —Ü–µ–Ω—Ç—Ä–æ–º –Ω–∞ –•–∞—Ä–∫–æ–≤—ñ
                    this.map = L.map('map').setView([49.9935, 36.2304], 13);
                    console.log('Map created');
                    
                    // –î–æ–¥–∞–≤–∞–Ω–Ω—è —Ç–∞–π–ª—ñ–≤ OpenStreetMap
                    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                        attribution: '¬© OpenStreetMap contributors'
                    }).addTo(this.map);
                    console.log('Tiles added');
                } catch (error) {
                    console.error('Map initialization error:', error);
                }
            }
            
            bindEvents() {
                // –ü—Ä–∏–≤'—è–∑–∫–∞ –ø–æ–¥—ñ–π –¥–æ –∫–Ω–æ–ø–æ–∫ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É
                document.getElementById('sosBtn').onclick = () => this.showAddGroupModal();           // –ö–Ω–æ–ø–∫–∞ SOS
                document.getElementById('incidentsBtn').onclick = () => this.toggleIncidentsPanel(); // –ö–Ω–æ–ø–∫–∞ —ñ–Ω—Ü–∏–¥–µ–Ω—Ç—ñ–≤
                document.getElementById('hospitalBtn').onclick = () => this.showHospitalMenu();      // –ö–Ω–æ–ø–∫–∞ –ª—ñ–∫–∞—Ä–µ–Ω—å
                document.getElementById('groupBtn').onclick = () => this.showGroupMenu();            // –ö–Ω–æ–ø–∫–∞ –≥—Ä—É–ø
                document.getElementById('activateBtn').onclick = () => this.activateSelectedGroups(); // –ê–∫—Ç–∏–≤–∞—Ü—ñ—è –≥—Ä—É–ø
                document.getElementById('saveVictimBtn').onclick = () => this.saveVictim();          // –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –∫–∞—Ä—Ç–∫–∏ –ø–æ—Å—Ç—Ä–∞–∂–¥–∞–ª–æ–≥–æ
                document.getElementById('saveHospitalBtn').onclick = () => this.saveHospital();      // –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –ª—ñ–∫–∞—Ä–Ω—ñ
                document.getElementById('saveGroupBtn').onclick = () => this.saveGroup();            // –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –≥—Ä—É–ø–∏
                document.getElementById('dataBtn').onclick = () => this.showDataMenu();              // –ú–µ–Ω—é –¥–∞–Ω–∏—Ö
                document.getElementById('logInput').onkeypress = (e) => { if (e.key === 'Enter') this.addLog(); }; // Enter –≤ –ø–æ–ª—ñ –ª–æ–≥—ñ–≤
            }
            
            makePanelsDraggable() {
                const panels = document.querySelectorAll('.panel');
                panels.forEach(panel => {
                    const header = panel.querySelector('.panel-header');
                    let isDragging = false;
                    let currentX, currentY, initialX, initialY;
                    
                    header.addEventListener('mousedown', (e) => {
                        isDragging = true;
                        initialX = e.clientX - panel.offsetLeft;
                        initialY = e.clientY - panel.offsetTop;
                    });
                    
                    document.addEventListener('mousemove', (e) => {
                        if (isDragging) {
                            currentX = e.clientX - initialX;
                            currentY = e.clientY - initialY;
                            panel.style.left = currentX + 'px';
                            panel.style.top = currentY + 'px';
                        }
                    });
                    
                    document.addEventListener('mouseup', () => {
                        isDragging = false;
                    });
                });
            }
            
            async loadLocations() {
                try {
                    // –°–ø–æ—á–∞—Ç–∫—É –ø—Ä–æ–±—É—î–º–æ localStorage
                    const saved = localStorage.getItem('sosLocations');
                    if (saved) {
                        const data = JSON.parse(saved);
                        this.groups = data.groups || [];
                        this.hospitals = data.hospitals || [];
                        console.log('–õ–æ–∫–∞—Ü—ñ—ó –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ –∑ localStorage');
                        return;
                    }
                    
                    // –Ø–∫—â–æ –Ω–µ–º–∞—î –≤ localStorage, –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –∑ JSON
                    const response = await fetch('./locations.json');
                    const data = await response.json();
                    this.groups = data.groups || [];
                    this.hospitals = data.hospitals || [];
                    console.log('–õ–æ–∫–∞—Ü—ñ—ó –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ –∑ JSON');
                } catch (error) {
                    console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ª–æ–∫–∞—Ü—ñ–π:', error);
                    this.groups = this.generateDefaultGroups();
                    this.hospitals = this.generateDefaultHospitals();
                }
            }
            
            async saveLocations() {
                const data = {
                    groups: this.groups,
                    hospitals: this.hospitals,
                    lastUpdated: new Date().toISOString()
                };
                
                try {
                    localStorage.setItem('sosLocations', JSON.stringify(data));
                    console.log('–õ–æ–∫–∞—Ü—ñ—ó –∑–±–µ—Ä–µ–∂–µ–Ω–æ –≤ localStorage');
                } catch (error) {
                    console.error('–ü–æ–º–∏–ª–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è:', error);
                }
            }
            
            generateDefaultGroups() {
                return [
                    { id: 0, name: '–ê–ª—å—Ñ–∞-1', type: '–ù–¢–û', personnel: 6, lat: 49.9935, lng: 36.2304, active: false, draggable: true },
                    { id: 1, name: '–ë—Ä–∞–≤–æ-2', type: '–†–æ–∑–º—ñ–Ω—É–≤–∞–Ω–Ω—è', personnel: 8, lat: 49.2089, lng: 37.2567, active: false, draggable: true },
                    { id: 2, name: '–ß–∞—Ä–ª—ñ-3', type: '–Ü–ù–†–ú', personnel: 5, lat: 49.7089, lng: 37.6234, active: false, draggable: true },
                    { id: 3, name: '–î–µ–ª—å—Ç–∞-4', type: '–¢–û', personnel: 7, lat: 49.4567, lng: 36.8234, active: false, draggable: true },
                    { id: 4, name: '–ï—Ö–æ-5', type: '–ù–¢–û', personnel: 6, lat: 48.8890, lng: 36.3234, active: false, draggable: true }
                ];
            }
            
            generateDefaultHospitals() {
                return [
                    { 
                        id: 1,
                        name: '–û–±–ª–∞—Å–Ω–∞ –∫–ª—ñ–Ω—ñ—á–Ω–∞ –ª—ñ–∫–∞—Ä–Ω—è', 
                        lat: 49.9947, 
                        lng: 36.2310,
                        address: '–≤—É–ª. –û–∑–µ—Ä—è–Ω—Å—å–∫–∞, 5, –•–∞—Ä–∫—ñ–≤',
                        contactPerson: '–Ü–≤–∞–Ω–æ–≤ –ü–µ—Ç—Ä–æ –°–µ—Ä–≥—ñ–π–æ–≤–∏—á',
                        emergencyPhone: '+380577123456',
                        draggable: true,
                        staff: [
                            { name: '–ü–µ—Ç—Ä–µ–Ω–∫–æ –ê.–í.', position: '–•—ñ—Ä—É—Ä–≥', schedule: '8:00-16:00', phone: '+380501234567' }
                        ]
                    },
                    { 
                        id: 2,
                        name: '–ú—ñ—Å—å–∫–∞ –ª—ñ–∫–∞—Ä–Ω—è ‚Ññ2', 
                        lat: 49.9889, 
                        lng: 36.2278,
                        address: '–≤—É–ª. –ü—É—à–∫—ñ–Ω—Å—å–∫–∞, 15, –•–∞—Ä–∫—ñ–≤',
                        contactPerson: '–ö–æ–≤–∞–ª–µ–Ω–∫–æ –û–ª–µ–Ω–∞ –ú–∏–∫–æ–ª–∞—ó–≤–Ω–∞',
                        emergencyPhone: '+380577234567',
                        draggable: true,
                        staff: []
                    },
                    { 
                        id: 3,
                        name: '–õ—ñ–∫–∞—Ä–Ω—è —à–≤–∏–¥–∫–æ—ó –¥–æ–ø–æ–º–æ–≥–∏', 
                        lat: 49.9823, 
                        lng: 36.2156,
                        address: '–≤—É–ª. –ë–∞–ª–∞–∫—ñ—Ä—î–≤–∞, 3–∞, –•–∞—Ä–∫—ñ–≤',
                        contactPerson: '–ú–æ—Ä–æ–∑–æ–≤ –í—ñ–∫—Ç–æ—Ä –Ü–≤–∞–Ω–æ–≤–∏—á',
                        emergencyPhone: '+380577456789',
                        draggable: true,
                        staff: []
                    }
                ];
            }
            
            addGroupMarkers() {
                // –û—á–∏—â—É—î–º–æ —Å—Ç–∞—Ä—ñ –º–∞—Ä–∫–µ—Ä–∏ –≥—Ä—É–ø
                this.groupMarkers.forEach(({ marker }) => {
                    this.map.removeLayer(marker);
                });
                this.groupMarkers = [];
                
                // –î–æ–¥–∞—î–º–æ –º–∞—Ä–∫–µ—Ä–∏ —Ç—ñ–ª—å–∫–∏ –¥–ª—è –ù–ï–∞–∫—Ç–∏–≤–Ω–∏—Ö –≥—Ä—É–ø
                this.groups.filter(group => !group.active).forEach(group => {
                    this.addSingleGroupMarker(group);
                });
            }
            
            addSingleGroupMarker(group) {
                const icon = L.divIcon({ 
                    html: '<div class="marker-group"></div>', 
                    className: 'custom-marker', 
                    iconSize: [20, 20], 
                    iconAnchor: [10, 10] 
                });
                
                const marker = L.marker([group.lat, group.lng], { icon }).addTo(this.map);
                this.groupMarkers.push({ marker, group });
                this.updateGroupPopup(marker, group);
            }
            
            updateGroupPopup(marker, group) {
                let popupContent = `
                    <div style="min-width: 200px;">
                        <strong>${group.name}</strong><br>
                        ${group.type} | ${group.personnel} –æ—Å—ñ–±<br>
                        <small>${group.lat.toFixed(6)}, ${group.lng.toFixed(6)}</small><br>
                        <div style="margin-top: 10px; display: grid; grid-template-columns: 1fr 1fr; gap: 5px;">
                            <button onclick="sosSystem.editGroupFromMap(${group.id})" style="background: #9C27B0; color: white; border: none; padding: 8px; border-radius: 4px; cursor: pointer; font-size: 12px;">‚úèÔ∏è</button>
                            <button onclick="navigator.clipboard.writeText('${group.lat.toFixed(6)}, ${group.lng.toFixed(6)}'); sosSystem.showNotification('–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ')" style="background: #1976d2; color: white; border: none; padding: 8px; border-radius: 4px; cursor: pointer; font-size: 12px;">üìã</button>
                            <button onclick="sosSystem.findNearestHospitalForGroup(${group.id})" style="background: #FF9800; color: white; border: none; padding: 8px; border-radius: 4px; cursor: pointer; font-size: 12px;">üè•</button>
                            <button onclick="window.open('https://www.google.com/maps?q=${group.lat},${group.lng}', '_blank')" style="background: #4CAF50; color: white; border: none; padding: 8px; border-radius: 4px; cursor: pointer; font-size: 12px;">üó∫Ô∏è</button>
                        </div>
                        <button onclick="sosSystem.activateGroupFromMap(${group.id})" style="background: #d32f2f; color: white; border: none; padding: 10px; border-radius: 6px; cursor: pointer; margin-top: 8px; width: 100%; font-weight: bold;">üÜò SOS</button>
                    </div>
                `;
                marker.bindPopup(popupContent);
            }
            
            addHospitalMarkers() {
                // –î–æ–¥–∞–≤–∞–Ω–Ω—è –º–∞—Ä–∫–µ—Ä—ñ–≤ –ª—ñ–∫–∞—Ä–µ–Ω—å –Ω–∞ –∫–∞—Ä—Ç—É –∑ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—é –ø–µ—Ä–µ—Ç—è–≥—É–≤–∞–Ω–Ω—è
                this.hospitalMarkers = [];
                this.hospitals.forEach(hospital => {
                    this.addSingleHospitalMarker(hospital);
                });
            }
            
            addSingleHospitalMarker(hospital) {
                const icon = L.divIcon({ 
                    html: '<div class="marker-hospital"></div>', 
                    className: 'custom-marker', 
                    iconSize: [18, 18], 
                    iconAnchor: [9, 9] 
                });
                
                const marker = L.marker([hospital.lat, hospital.lng], { icon }).addTo(this.map);
                this.hospitalMarkers = this.hospitalMarkers || [];
                this.hospitalMarkers.push({ marker, hospital });
                this.updateHospitalPopup(marker, hospital);
            }
            
            updateHospitalPopup(marker, hospital) {
                let hospitalPopup = `
                    <div style="min-width: 200px;">
                        <strong>${hospital.name}</strong><br>
                        <small>–õ—ñ–∫–∞—Ä–Ω—è</small><br>
                        ${hospital.address ? hospital.address + '<br>' : ''}
                        <small>${hospital.lat.toFixed(6)}, ${hospital.lng.toFixed(6)}</small><br>
                        <div style="margin-top: 10px; display: grid; grid-template-columns: 1fr 1fr; gap: 5px;">
                            <button onclick="sosSystem.editHospitalFromMap(${hospital.id})" style="background: #9C27B0; color: white; border: none; padding: 8px; border-radius: 4px; cursor: pointer; font-size: 12px;">‚úèÔ∏è</button>
                            <button onclick="navigator.clipboard.writeText('${hospital.lat.toFixed(6)}, ${hospital.lng.toFixed(6)}'); sosSystem.showNotification('–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ')" style="background: #1976d2; color: white; border: none; padding: 8px; border-radius: 4px; cursor: pointer; font-size: 12px;">üìã</button>
                            <button onclick="window.open('https://www.google.com/maps?q=${hospital.lat},${hospital.lng}', '_blank')" style="background: #4CAF50; color: white; border: none; padding: 8px; border-radius: 4px; cursor: pointer; font-size: 12px;">üó∫Ô∏è</button>
                            <button onclick="sosSystem.deleteHospital(${hospital.id})" style="background: #f44336; color: white; border: none; padding: 8px; border-radius: 4px; cursor: pointer; font-size: 12px;">üóëÔ∏è</button>
                        </div>
                    </div>
                `;
                marker.bindPopup(hospitalPopup);
            }
            
            showAddGroupModal() {
                this.updateGroupGrid();
                document.getElementById('addGroupModal').classList.add('active');
            }
            
            closeAddGroupModal() {
                document.getElementById('addGroupModal').classList.remove('active');
                this.selectedGroups = [];
            }
            
            updateGroupGrid() {
                const grid = document.getElementById('groupGrid');
                grid.innerHTML = '';
                this.groups.filter(g => !g.active).forEach(group => {
                    const card = document.createElement('div');
                    card.className = 'group-card';
                    card.innerHTML = `<div class="group-name">${group.name}</div><div class="group-info">${group.type}<br>${group.personnel} –æ—Å—ñ–±</div>`;
                    card.onclick = () => {
                        card.classList.toggle('selected');
                        const index = this.selectedGroups.indexOf(group.id);
                        if (index > -1) this.selectedGroups.splice(index, 1);
                        else this.selectedGroups.push(group.id);
                    };
                    grid.appendChild(card);
                });
            }
            
            activateSelectedGroups() {
                if (this.selectedGroups.length === 0) { this.showNotification('–û–±–µ—Ä—ñ—Ç—å —Ö–æ—á–∞ –± –æ–¥–Ω—É –≥—Ä—É–ø—É', 'error'); return; }
                this.selectedGroups.forEach(groupId => this.activateGroup(groupId));
                this.closeAddGroupModal();
                this.startSOS();
            }
            
            activateGroup(groupId) {
                const group = this.groups.find(g => g.id === groupId);
                if (!group || group.active) return;
                group.active = true;
                const incident = { id: Date.now() + groupId, group, startTime: Date.now() };
                this.activeIncidents.push(incident);
                this.incidentVictims[incident.id] = [];
                this.incidentLogs[incident.id] = [];
                
                // –ó–Ω–∞—Ö–æ–¥–∏–º–æ –∑–≤–∏—á–∞–π–Ω–∏–π –º–∞—Ä–∫–µ—Ä –≥—Ä—É–ø–∏ —Ç–∞ –í–ò–î–ê–õ–Ø–Ñ–ú–û –π–æ–≥–æ
                const markerData = this.groupMarkers.find(m => m.group.id === groupId);
                if (markerData) {
                    this.map.removeLayer(markerData.marker); // –í–∏–¥–∞–ª—è—î–º–æ –∑–≤–∏—á–∞–π–Ω–∏–π –º–∞—Ä–∫–µ—Ä
                }
                
                this.createSOSMarker(); // –°—Ç–≤–æ—Ä—é—î–º–æ SOS –º–∞—Ä–∫–µ—Ä –∑–∞–º—ñ—Å—Ç—å –∑–≤–∏—á–∞–π–Ω–æ–≥–æ
            }
            
            startSOS() {
                // –ó–∞–ø—É—Å–∫ SOS —Ä–µ–∂–∏–º—É
                if (this.isActive) return;
                this.isActive = true;
                document.getElementById('incidentsBtn').classList.remove('hidden'); // –ü–æ–∫–∞–∑—É—î–º–æ –∫–Ω–æ–ø–∫—É —ñ–Ω—Ü–∏–¥–µ–Ω—Ç—ñ–≤
                this.createSOSMarker();             // –°—Ç–≤–æ—Ä—é—î–º–æ SOS –º–∞—Ä–∫–µ—Ä–∏
                this.showIncidentsPanel();          // –ü–æ–∫–∞–∑—É—î–º–æ –ø–∞–Ω–µ–ª—å —ñ–Ω—Ü–∏–¥–µ–Ω—Ç—ñ–≤
                this.startWaves();                  // –ó–∞–ø—É—Å–∫–∞—î–º–æ –∞–Ω—ñ–º–∞—Ü—ñ—é —Ö–≤–∏–ª—å
            }
            
            createSOSMarker() {
                // –°—Ç–≤–æ—Ä–µ–Ω–Ω—è SOS –º–∞—Ä–∫–µ—Ä—ñ–≤ –¥–ª—è –≤—Å—ñ—Ö –∞–∫—Ç–∏–≤–Ω–∏—Ö —ñ–Ω—Ü–∏–¥–µ–Ω—Ç—ñ–≤
                if (this.activeIncidents.length === 0) return;
                
                // –í–∏–¥–∞–ª—è—î–º–æ —Å—Ç–∞—Ä—ñ SOS –º–∞—Ä–∫–µ—Ä–∏
                if (this.sosMarkers) {
                    this.sosMarkers.forEach(marker => this.map.removeLayer(marker));
                }
                this.sosMarkers = [];
                
                // –°—Ç–≤–æ—Ä—é—î–º–æ SOS –º–∞—Ä–∫–µ—Ä –¢–û–ß–ù–û –Ω–∞ –º—ñ—Å—Ü—ñ –≥—Ä—É–ø–∏ –ë–ï–ó –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
                this.activeIncidents.forEach(incident => {
                    const groupLat = incident.group.lat;  // –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ –ì–†–£–ü–ò
                    const groupLng = incident.group.lng;  // –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ –ì–†–£–ü–ò
                    const incidentPos = [groupLat, groupLng];
                    
                    const nearestHospital = this.findNearestHospital(incidentPos);
                    const nearestGroup = this.findNearestAvailableGroup(incidentPos);
                    
                    const icon = L.divIcon({ 
                        html: '<div class="marker-sos"></div>', 
                        className: 'custom-marker', 
                        iconSize: [30, 30], 
                        iconAnchor: [15, 15] 
                    });
                    
                    let popupContent = `<strong>üÜò –ù–ê–î–ó–í–ò–ß–ê–ô–ù–ê –°–ò–¢–£–ê–¶–Ü–Ø</strong><br>`;
                    popupContent += `–ì—Ä—É–ø–∞: ${incident.group.name}<br>`;
                    popupContent += `–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏: ${groupLat.toFixed(6)}, ${groupLng.toFixed(6)}<br>`;
                    
                    if (nearestHospital) {
                        const hospitalDistance = (this.calculateDistance(incidentPos, [nearestHospital.lat, nearestHospital.lng]) * 111).toFixed(1);
                        popupContent += `üè• –ù–∞–π–±–ª–∏–∂—á–∞ –ª—ñ–∫–∞—Ä–Ω—è: ${nearestHospital.name} (${hospitalDistance} –∫–º)<br>`;
                    }
                    
                    if (nearestGroup) {
                        const groupDistance = (this.calculateDistance(incidentPos, [nearestGroup.lat, nearestGroup.lng]) * 111).toFixed(1);
                        popupContent += `üë• –ù–∞–π–±–ª–∏–∂—á–∞ –≥—Ä—É–ø–∞: ${nearestGroup.name} (${groupDistance} –∫–º)<br>`;
                    }
                    
                    popupContent += `<div style="margin-top: 8px; display: flex; gap: 5px;">`;
                    popupContent += `<button onclick="sosSystem.routeToSOS(${groupLat}, ${groupLng})" style="background: #FF5722; color: white; border: none; padding: 6px 10px; border-radius: 4px; cursor: pointer; font-size: 12px;">üìç</button>`;
                    popupContent += `<button onclick="navigator.clipboard.writeText('${groupLat.toFixed(6)}, ${groupLng.toFixed(6)}'); sosSystem.showNotification('–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ')" style="background: #1976d2; color: white; border: none; padding: 6px 10px; border-radius: 4px; cursor: pointer; font-size: 12px;">üìã</button>`;
                    popupContent += `<button onclick="window.open('https://www.google.com/maps?q=${groupLat},${groupLng}', '_blank')" style="background: #4CAF50; color: white; border: none; padding: 6px 10px; border-radius: 4px; cursor: pointer; font-size: 12px;">üó∫Ô∏è</button>`;
                    popupContent += `</div>`;
                    
                    // SOS –º–∞—Ä–∫–µ—Ä —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –¢–û–ß–ù–û –Ω–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞—Ö –≥—Ä—É–ø–∏
                    const sosMarker = L.marker([groupLat, groupLng], { icon })
                        .bindPopup(popupContent)
                        .addTo(this.map);
                    
                    this.sosMarkers.push(sosMarker);
                });
            }
            
            showIncidentsPanel() {
                document.getElementById('incidentsPanel').classList.add('active');
                this.updateIncidentsList();
                this.alertInterval = setInterval(() => this.updateIncidentsList(), 1000);
            }
            
            toggleIncidentsPanel() {
                const panel = document.getElementById('incidentsPanel');
                if (panel.classList.contains('active')) {
                    this.closeIncidentsPanel();
                } else {
                    this.showIncidentsPanel();
                }
            }
            
            closeIncidentsPanel() {
                document.getElementById('incidentsPanel').classList.remove('active');
                if (this.alertInterval) {
                    clearInterval(this.alertInterval);
                    this.alertInterval = null;
                }
            }
            
            updateIncidentsList() {
                const list = document.getElementById('incidentsList');
                list.innerHTML = '';
                this.activeIncidents.forEach(incident => {
                    const elapsed = Math.floor((Date.now() - incident.startTime) / 1000);
                    const minutes = Math.floor(elapsed / 60).toString().padStart(2, '0');
                    const seconds = (elapsed % 60).toString().padStart(2, '0');
                    const card = document.createElement('div');
                    card.className = 'incident-card';
                    card.innerHTML = `
                        <div class="incident-header">
                            <div class="incident-name">${incident.group.name}</div>
                            <div class="incident-time">${minutes}:${seconds}</div>
                        </div>
                        <div class="incident-menu">
                            <button onclick="sosSystem.goToIncident(${incident.id})" class="btn-sm btn-primary">
                                <i class="fas fa-eye"></i> –ü–µ—Ä–µ–π—Ç–∏
                            </button>
                            <button onclick="sosSystem.showRoutes(${incident.id})" class="btn-sm btn-warning">
                                <i class="fas fa-route"></i> –ú–∞—Ä—à—Ä—É—Ç
                            </button>
                            <button onclick="sosSystem.showLogs(${incident.id})" class="btn-sm btn-primary">
                                <i class="fas fa-list"></i> –õ–æ–≥–∏
                            </button>
                            <button onclick="sosSystem.showVictims(${incident.id})" class="btn-sm btn-success">
                                <i class="fas fa-user-injured"></i> –ö–∞—Ä—Ç–∫–∞
                            </button>
                            <button onclick="sosSystem.stopIncident(${incident.id})" class="btn-sm btn-danger">
                                <i class="fas fa-stop"></i> –°—Ç–æ–ø
                            </button>
                        </div>
                    `;
                    list.appendChild(card);
                });
            }
            
            goToIncident(incidentId) {
                const incident = this.activeIncidents.find(i => i.id === incidentId);
                if (incident) this.map.setView([incident.group.lat, incident.group.lng], 16, { animate: true, duration: 1.5 });
            }
            
            showRoutes(incidentId) {
                const incident = this.activeIncidents.find(i => i.id === incidentId);
                if (!incident) return;
                this.clearRoutes();
                const incidentPos = [incident.group.lat, incident.group.lng];
                
                // –ú–∞—Ä—à—Ä—É—Ç –¥–æ –Ω–∞–π–±–ª–∏–∂—á–æ—ó –ª—ñ–∫–∞—Ä–Ω—ñ
                const nearestHospital = this.findNearestHospital(incidentPos);
                if (nearestHospital) {
                    const hospitalRoute = L.Routing.control({
                        waypoints: [L.latLng(incidentPos[0], incidentPos[1]), L.latLng(nearestHospital.lat, nearestHospital.lng)],
                        routeWhileDragging: false, addWaypoints: false, createMarker: () => null, show: false,
                        lineOptions: { styles: [{ color: '#d32f2f', weight: 6, opacity: 0.8 }] }
                    }).addTo(this.map);
                    this.routeControls.push(hospitalRoute);
                }
                
                // –ú–∞—Ä—à—Ä—É—Ç –¥–æ –Ω–∞–π–±–ª–∏–∂—á–æ—ó –¥–æ—Å—Ç—É–ø–Ω–æ—ó –≥—Ä—É–ø–∏
                const nearestGroup = this.findNearestAvailableGroup(incidentPos);
                if (nearestGroup) {
                    const groupRoute = L.Routing.control({
                        waypoints: [L.latLng(incidentPos[0], incidentPos[1]), L.latLng(nearestGroup.lat, nearestGroup.lng)],
                        routeWhileDragging: false, addWaypoints: false, createMarker: () => null, show: false,
                        lineOptions: { styles: [{ color: '#1976d2', weight: 6, opacity: 0.8 }] }
                    }).addTo(this.map);
                    this.routeControls.push(groupRoute);
                }
                
                this.showNotification('üìç –ú–∞—Ä—à—Ä—É—Ç–∏ –ø–æ–±—É–¥–æ–≤–∞–Ω–æ');
            }
            
            showLogs(incidentId) {
                this.currentIncidentId = incidentId;
                const incident = this.activeIncidents.find(i => i.id === incidentId);
                document.getElementById('logsIncidentName').textContent = incident.group.name;
                this.updateLogsDisplay();
                document.getElementById('logsModal').classList.add('active');
            }
            
            closeLogsModal() {
                document.getElementById('logsModal').classList.remove('active');
                this.currentIncidentId = null;
            }
            
            showVictims(incidentId) {
                this.currentIncidentId = incidentId;
                const incident = this.activeIncidents.find(i => i.id === incidentId);
                document.getElementById('victimIncidentName').textContent = incident.group.name;
                this.updateVictimList();
                document.getElementById('victimModal').classList.add('active');
            }
            
            closeVictimModal() {
                document.getElementById('victimModal').classList.remove('active');
                this.currentIncidentId = null;
            }
            
            stopIncident(incidentId) {
                const incidentIndex = this.activeIncidents.findIndex(i => i.id === incidentId);
                if (incidentIndex === -1) return;
                const incident = this.activeIncidents[incidentIndex];
                incident.group.active = false;
                
                // –í–∏–¥–∞–ª—è—î–º–æ SOS –º–∞—Ä–∫–µ—Ä —Ç–∞ –ø–æ–≤–µ—Ä—Ç–∞—î–º–æ –∑–≤–∏—á–∞–π–Ω–∏–π –º–∞—Ä–∫–µ—Ä –≥—Ä—É–ø–∏
                this.sosMarkers.forEach(marker => {
                    if (marker.getLatLng().lat === incident.group.lat && marker.getLatLng().lng === incident.group.lng) {
                        this.map.removeLayer(marker);
                    }
                });
                
                // –ü–æ–≤–µ—Ä—Ç–∞—î–º–æ –∑–≤–∏—á–∞–π–Ω–∏–π –º–∞—Ä–∫–µ—Ä –≥—Ä—É–ø–∏
                this.addSingleGroupMarker(incident.group);
                
                this.activeIncidents.splice(incidentIndex, 1);
                delete this.incidentVictims[incidentId];
                delete this.incidentLogs[incidentId];
                this.saveLocations();               // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ —Å—Ç–∞–Ω –≥—Ä—É–ø
                if (this.activeIncidents.length === 0) this.stopAllSOS();
            }
            
            stopAllSOS() {
                // –ó—É–ø–∏–Ω–∫–∞ –≤—Å—ñ—Ö SOS –æ–ø–µ—Ä–∞—Ü—ñ–π
                this.isActive = false;
                this.groups.forEach(group => group.active = false);                 // –î–µ–∞–∫—Ç–∏–≤—É—î–º–æ –≤—Å—ñ –≥—Ä—É–ø–∏
                
                // –í–∏–¥–∞–ª—è—î–º–æ –≤—Å—ñ SOS –º–∞—Ä–∫–µ—Ä–∏ —Ç–∞ –ø–æ–≤–µ—Ä—Ç–∞—î–º–æ –∑–≤–∏—á–∞–π–Ω—ñ –º–∞—Ä–∫–µ—Ä–∏ –≥—Ä—É–ø
                if (this.sosMarkers) { 
                    this.sosMarkers.forEach(marker => this.map.removeLayer(marker)); 
                    this.sosMarkers = []; 
                }
                
                // –ü–æ–≤–µ—Ä—Ç–∞—î–º–æ –≤—Å—ñ –∑–≤–∏—á–∞–π–Ω—ñ –º–∞—Ä–∫–µ—Ä–∏ –≥—Ä—É–ø
                this.addGroupMarkers();
                
                this.activeIncidents = [];                                          // –û—á–∏—â—É—î–º–æ —ñ–Ω—Ü–∏–¥–µ–Ω—Ç–∏
                this.incidentVictims = {};                                          // –û—á–∏—â—É—î–º–æ –∫–∞—Ä—Ç–∫–∏ –ø–æ—Å—Ç—Ä–∞–∂–¥–∞–ª–∏—Ö
                this.incidentLogs = {};                                             // –û—á–∏—â—É—î–º–æ –ª–æ–≥–∏
                
                document.getElementById('incidentsBtn').classList.add('hidden');    // –•–æ–≤–∞—î–º–æ –∫–Ω–æ–ø–∫—É —ñ–Ω—Ü–∏–¥–µ–Ω—Ç—ñ–≤
                this.closeIncidentsPanel();         // –ó–∞–∫—Ä–∏–≤–∞—î–º–æ –ø–∞–Ω–µ–ª—å —ñ–Ω—Ü–∏–¥–µ–Ω—Ç—ñ–≤
                this.stopWaves();                   // –ó—É–ø–∏–Ω—è—î–º–æ –∞–Ω—ñ–º–∞—Ü—ñ—é —Ö–≤–∏–ª—å
                this.clearRoutes();                 // –û—á–∏—â—É—î–º–æ –º–∞—Ä—à—Ä—É—Ç–∏
                this.saveLocations();               // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ —Å—Ç–∞–Ω –≥—Ä—É–ø
                this.showNotification('SOS —Ä–µ–∂–∏–º –∑—É–ø–∏–Ω–µ–Ω–æ');
            }
            
            findNearestHospital(pos) {
                let nearest = null, minDistance = Infinity;
                this.hospitals.forEach(hospital => {
                    const distance = this.calculateDistance(pos, [hospital.lat, hospital.lng]);
                    if (distance < minDistance) { minDistance = distance; nearest = hospital; }
                });
                return nearest;
            }
            
            findNearestAvailableGroup(pos) {
                let nearest = null, minDistance = Infinity;
                this.groups.filter(g => !g.active).forEach(group => {
                    const distance = this.calculateDistance(pos, [group.lat, group.lng]);
                    if (distance < minDistance) { minDistance = distance; nearest = group; }
                });
                return nearest;
            }
            
            calculateDistance(pos1, pos2) {
                const latDiff = pos1[0] - pos2[0], lngDiff = pos1[1] - pos2[1];
                return Math.sqrt(latDiff * latDiff + lngDiff * lngDiff);
            }
            
            clearRoutes() { this.routeControls.forEach(control => this.map.removeControl(control)); this.routeControls = []; }
            
            startWaves() { this.waveInterval = setInterval(() => this.createWave(), 2300); }
            
            stopWaves() {
                if (this.waveInterval) { clearInterval(this.waveInterval); this.waveInterval = null; }
                document.querySelectorAll('.wave').forEach(wave => wave.remove());
            }
            
            createWave() {
                // –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∞–Ω—ñ–º–∞—Ü—ñ—ó —Ö–≤–∏–ª—å –¢–Ü–õ–¨–ö–ò –≤—ñ–¥ SOS –º–∞—Ä–∫–µ—Ä—ñ–≤ (–∞–∫—Ç–∏–≤–Ω–∏—Ö –≥—Ä—É–ø)
                if (!this.sosMarkers || this.sosMarkers.length === 0) return;
                
                this.sosMarkers.forEach(sosMarker => {
                    // –û—Ç—Ä–∏–º—É—î–º–æ –ø–æ–∑–∏—Ü—ñ—é SOS –º–∞—Ä–∫–µ—Ä–∞ –Ω–∞ –µ–∫—Ä–∞–Ω—ñ
                    const markerPos = this.map.latLngToContainerPoint(sosMarker.getLatLng());
                    
                    // –ü–µ—Ä—à–∞ —Ö–≤–∏–ª—è
                    const wave = document.createElement('div');
                    wave.className = 'wave';
                    wave.style.left = markerPos.x + 'px';
                    wave.style.top = markerPos.y + 'px';
                    wave.style.transform = 'translate(-50%, -50%)';
                    wave.style.zIndex = '500';
                    document.body.appendChild(wave);
                    
                    // –î—Ä—É–≥–∞ —Ö–≤–∏–ª—è –∑ –∑–∞—Ç—Ä–∏–º–∫–æ—é
                    setTimeout(() => {
                        const wave2 = document.createElement('div');
                        wave2.className = 'wave';
                        wave2.style.left = markerPos.x + 'px';
                        wave2.style.top = markerPos.y + 'px';
                        wave2.style.transform = 'translate(-50%, -50%)';
                        wave2.style.opacity = '0.6';
                        wave2.style.zIndex = '499';
                        document.body.appendChild(wave2);
                        
                        setTimeout(() => { if (wave2.parentNode) wave2.remove(); }, 4600);
                    }, 575);
                    
                    setTimeout(() => { if (wave.parentNode) wave.remove(); }, 4600);
                });
            }
            
            addLog(text = null) {
                if (!this.currentIncidentId) return;
                const input = document.getElementById('logInput');
                const logText = text || input.value.trim();
                if (!logText) return;
                const log = { time: new Date().toLocaleTimeString('uk-UA'), text: logText, timestamp: Date.now() };
                if (!this.incidentLogs[this.currentIncidentId]) this.incidentLogs[this.currentIncidentId] = [];
                this.incidentLogs[this.currentIncidentId].unshift(log);
                this.updateLogsDisplay();
                if (input) input.value = '';
            }
            
            updateLogsDisplay() {
                if (!this.currentIncidentId) return;
                const content = document.getElementById('logsContent');
                const logs = this.incidentLogs[this.currentIncidentId] || [];
                content.innerHTML = logs.map(log => `<div class="log-entry"><div class="log-time">${log.time}</div><div class="log-text">${this.escapeHtml(log.text)}</div></div>`).join('');
            }
            
            updateVictimList() {
                if (!this.currentIncidentId) return;
                const list = document.getElementById('victimList');
                const victims = this.incidentVictims[this.currentIncidentId] || [];
                list.innerHTML = '';
                victims.forEach((victim, index) => {
                    const item = document.createElement('div');
                    item.className = 'victim-item';
                    item.style.cursor = 'pointer';
                    item.innerHTML = `
                        <div onclick="sosSystem.viewVictim(${index})">
                            <div class="victim-name">${victim.name || '–ë–µ–∑ —ñ–º–µ–Ω—ñ'}</div>
                            <div class="victim-injury">${victim.injury || '–ù–µ –≤–∫–∞–∑–∞–Ω–æ'}</div>
                            <div style="font-size: 11px; color: #666;">
                                ${victim.pulse ? `–ü—É–ª—å—Å: ${victim.pulse}` : ''} 
                                ${victim.bloodPressure ? `–ê–¢: ${victim.bloodPressure}` : ''}
                            </div>
                        </div>
                        <div>
                            <button onclick="sosSystem.editVictim(${index})" class="btn-sm btn-primary"><i class="fas fa-edit"></i></button>
                            <button onclick="sosSystem.deleteVictim(${index})" class="btn-sm btn-danger"><i class="fas fa-trash"></i></button>
                        </div>
                    `;
                    list.appendChild(item);
                });
            }
            
            saveVictim() {
                if (!this.currentIncidentId) return;
                const victim = {
                    id: Date.now(), 
                    name: document.getElementById('victimName').value,
                    age: document.getElementById('victimAge').value,
                    injury: document.getElementById('injuryType').value,
                    pulse: document.getElementById('pulse').value,
                    breathing: document.getElementById('breathing').value,
                    bloodPressure: document.getElementById('bloodPressure').value,
                    tourniquet: document.getElementById('tourniquet').value,
                    injuryDescription: document.getElementById('injuryDescription').value,
                    timestamp: new Date().toLocaleString('uk-UA')
                };
                if (!victim.name || !victim.injury) { this.showNotification('–ó–∞–ø–æ–≤–Ω—ñ—Ç—å –ü–Ü–ë —Ç–∞ —Ç–∏–ø —Ç—Ä–∞–≤–º–∏', 'error'); return; }
                if (!this.incidentVictims[this.currentIncidentId]) this.incidentVictims[this.currentIncidentId] = [];
                this.incidentVictims[this.currentIncidentId].push(victim);
                this.updateVictimList(); this.clearVictimForm();
                this.showNotification('–ö–∞—Ä—Ç–∫—É –∑–±–µ—Ä–µ–∂–µ–Ω–æ');
            }
            
            editVictim(index) {
                if (!this.currentIncidentId) return;
                const victim = this.incidentVictims[this.currentIncidentId][index];
                document.getElementById('victimName').value = victim.name || '';
                document.getElementById('victimAge').value = victim.age || '';
                document.getElementById('injuryType').value = victim.injury || '';
                document.getElementById('pulse').value = victim.pulse || '';
                document.getElementById('breathing').value = victim.breathing || '';
                document.getElementById('bloodPressure').value = victim.bloodPressure || '';
                document.getElementById('tourniquet').value = victim.tourniquet || '';
                document.getElementById('injuryDescription').value = victim.injuryDescription || '';
                this.incidentVictims[this.currentIncidentId].splice(index, 1);
                this.updateVictimList();
            }
            
            viewVictim(index) {
                if (!this.currentIncidentId) return;
                const victim = this.incidentVictims[this.currentIncidentId][index];
                let info = `<strong>${victim.name}</strong><br>`;
                info += `–í—ñ–∫: ${victim.age}<br>`;
                info += `–¢—Ä–∞–≤–º–∞: ${victim.injury}<br>`;
                if (victim.pulse) info += `–ü—É–ª—å—Å: ${victim.pulse} —É–¥/—Ö–≤<br>`;
                if (victim.breathing) info += `–î–∏—Ö–∞–Ω–Ω—è: ${victim.breathing} —Ä–∞–∑/—Ö–≤<br>`;
                if (victim.bloodPressure) info += `–ê–¢: ${victim.bloodPressure}<br>`;
                if (victim.tourniquet) info += `–¢—É—Ä–Ω—ñ–∫–µ—Ç: ${victim.tourniquet}<br>`;
                if (victim.injuryDescription) info += `–û–ø–∏—Å: ${victim.injuryDescription}<br>`;
                info += `–ß–∞—Å: ${victim.timestamp}`;
                alert(info);
            }
            
            deleteVictim(index) {
                if (!this.currentIncidentId) return;
                if (confirm('–í–∏–¥–∞–ª–∏—Ç–∏ –∫–∞—Ä—Ç–∫—É –ø–æ—Å—Ç—Ä–∞–∂–¥–∞–ª–æ–≥–æ?')) {
                    this.incidentVictims[this.currentIncidentId].splice(index, 1);
                    this.updateVictimList();
                    this.showNotification('–ö–∞—Ä—Ç–∫—É –≤–∏–¥–∞–ª–µ–Ω–æ');
                }
            }
            
            clearVictimForm() { document.getElementById('victimForm').reset(); }
            
            showNotification(message, type = 'success') {
                const notification = document.createElement('div');
                notification.className = `notification ${type}`;
                notification.innerHTML = `<i class="fas fa-${type === 'success' ? 'check' : type === 'error' ? 'times' : 'info'}"></i>${message}`;
                document.body.appendChild(notification);
                setTimeout(() => notification.classList.add('show'), 100);
                setTimeout(() => { notification.classList.remove('show'); setTimeout(() => notification.remove(), 300); }, 3000);
            }
            
            escapeHtml(text) { const div = document.createElement('div'); div.textContent = text; return div.innerHTML; }
            
            updateStaffList() {
                const list = document.getElementById('staffList');
                list.innerHTML = '';
                
                this.hospitalStaff.forEach((staff, index) => {
                    const item = document.createElement('div');
                    item.className = 'staff-item';
                    item.innerHTML = `
                        <div>
                            <strong>${staff.name}</strong> - ${staff.position}<br>
                            <small>${staff.schedule || '–ì—Ä–∞—Ñ—ñ–∫ –Ω–µ –≤–∫–∞–∑–∞–Ω–æ'} | ${staff.phone || '–¢–µ–ª. –Ω–µ –≤–∫–∞–∑–∞–Ω–æ'}</small>
                        </div>
                        <button onclick="removeStaff(${index})" class="btn-sm btn-danger">
                            <i class="fas fa-trash"></i>
                        </button>
                    `;
                    list.appendChild(item);
                });
            }
            
            initScaleBar() {
                // –ú–∞—Å—à—Ç–∞–±–Ω–∞ –ª—ñ–Ω—ñ–π–∫–∞ –≤–∏–º–∫–Ω–µ–Ω–∞ –¥–ª—è —à–≤–∏–¥—à–æ–≥–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
                // L.control.scale().addTo(this.map);
            }
            
            async getAddress(lat, lng) {
                // –û—Ç—Ä–∏–º–∞–Ω–Ω—è –∞–¥—Ä–µ—Å–∏ –∑–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏ –∑ –æ–±—Ä–æ–±–∫–æ—é –ø–æ–º–∏–ª–æ–∫
                try {
                    const response = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}&accept-language=uk`, {
                        headers: {
                            'User-Agent': 'SOS Emergency System'
                        }
                    });
                    
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}`);
                    }
                    
                    const data = await response.json();
                    return data.display_name || `${lat.toFixed(4)}, ${lng.toFixed(4)}`;
                } catch (error) {
                    console.log('–ü–æ–º–∏–ª–∫–∞ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –∞–¥—Ä–µ—Å–∏:', error);
                    return `${lat.toFixed(4)}, ${lng.toFixed(4)}`;
                }
            }
            
            getUserLocation() {
                // –û—Ç—Ä–∏–º–∞–Ω–Ω—è –≥–µ–æ–ª–æ–∫–∞—Ü—ñ—ó –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∑ –ø–æ–∫—Ä–∞—â–µ–Ω–æ—é –æ–±—Ä–æ–±–∫–æ—é –ø–æ–º–∏–ª–æ–∫
                if (!navigator.geolocation) {
                    console.log('–ì–µ–æ–ª–æ–∫–∞—Ü—ñ—è –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î—Ç—å—Å—è –±—Ä–∞—É–∑–µ—Ä–æ–º');
                    this.showNotification('–ì–µ–æ–ª–æ–∫–∞—Ü—ñ—è –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î—Ç—å—Å—è', 'error');
                    return;
                }
                
                // –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –¥–ª—è –≥–µ–æ–ª–æ–∫–∞—Ü—ñ—ó
                const options = {
                    enableHighAccuracy: true,  // –í–∏—Å–æ–∫–∞ —Ç–æ—á–Ω—ñ—Å—Ç—å
                    timeout: 10000,           // –¢–∞–π–º–∞—É—Ç 10 —Å–µ–∫—É–Ω–¥
                    maximumAge: 300000        // –ö–µ—à –Ω–∞ 5 —Ö–≤–∏–ª–∏–Ω
                };
                
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const userLat = position.coords.latitude;   // –®–∏—Ä–æ—Ç–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
                        const userLng = position.coords.longitude;  // –î–æ–≤–≥–æ—Ç–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
                        
                        console.log('–ì–µ–æ–ª–æ–∫–∞—Ü—ñ—è –æ—Ç—Ä–∏–º–∞–Ω–∞:', userLat, userLng);
                        
                        const userIcon = L.divIcon({
                            html: '<div class="user-pin"><div class="pin-head"></div><div class="pin-tail"></div></div>',
                            className: 'user-pin-marker',
                            iconSize: [20, 30],
                            iconAnchor: [10, 30]
                        });
                        
                        this.userLocation = { lat: userLat, lng: userLng };
                        this.userMarker = null; // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –º–∞—Ä–∫–µ—Ä –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
                        
                        this.getAddress(userLat, userLng).then(address => {
                            let userPopup = `<strong>üìç –í–∞—à–µ –º—ñ—Å—Ü–µ–∑–Ω–∞—Ö–æ–¥–∂–µ–Ω–Ω—è</strong><br>`;
                            userPopup += `–ê–¥—Ä–µ—Å–∞: ${address}<br>`;
                            userPopup += `–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏: ${userLat.toFixed(6)}, ${userLng.toFixed(6)}<br>`;
                            userPopup += `<div style="margin-top: 8px; display: flex; gap: 5px;">`;
                            userPopup += `<button onclick="navigator.clipboard.writeText('${userLat.toFixed(6)}, ${userLng.toFixed(6)}'); sosSystem.showNotification('–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ')" style="background: #1976d2; color: white; border: none; padding: 6px 10px; border-radius: 4px; cursor: pointer; font-size: 12px;">üìã</button>`;
                            userPopup += `<button onclick="window.open('https://www.google.com/maps?q=${userLat},${userLng}', '_blank')" style="background: #4CAF50; color: white; border: none; padding: 6px 10px; border-radius: 4px; cursor: pointer; font-size: 12px;">üó∫Ô∏è</button>`;
                            userPopup += `</div>`;
                            
                            this.userMarker = L.marker([userLat, userLng], { icon: userIcon })
                                .bindPopup(userPopup)
                                .addTo(this.map);
                                
                            this.showNotification('üìç –ú—ñ—Å—Ü–µ–∑–Ω–∞—Ö–æ–¥–∂–µ–Ω–Ω—è –≤–∏–∑–Ω–∞—á–µ–Ω–æ');
                        });
                    },
                    (error) => {
                        let errorMsg = '–ü–æ–º–∏–ª–∫–∞ –≥–µ–æ–ª–æ–∫–∞—Ü—ñ—ó: ';
                        switch(error.code) {
                            case error.PERMISSION_DENIED:
                                errorMsg += '–î–æ—Å—Ç—É–ø –∑–∞–±–æ—Ä–æ–Ω–µ–Ω–æ';
                                break;
                            case error.POSITION_UNAVAILABLE:
                                errorMsg += '–ü–æ–∑–∏—Ü—ñ—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞';
                                break;
                            case error.TIMEOUT:
                                errorMsg += '–¢–∞–π–º–∞—É—Ç –∑–∞–ø–∏—Ç—É';
                                break;
                            default:
                                errorMsg += '–ù–µ–≤—ñ–¥–æ–º–∞ –ø–æ–º–∏–ª–∫–∞';
                        }
                        console.log(errorMsg, error);
                        this.showNotification(errorMsg, 'error');
                    },
                    options
                );
            }
            
            activateGroupFromMap(groupId) {
                this.activateGroup(groupId);
                if (!this.isActive) this.startSOS();
                this.showNotification(`SOS –∞–∫—Ç–∏–≤–æ–≤–∞–Ω–æ –¥–ª—è –≥—Ä—É–ø–∏`);
            }
            
            showHospitalMenu() {
                const menu = document.createElement('div');
                menu.style.cssText = `
                    position: fixed;
                    bottom: 80px;
                    left: 20px;
                    background: white;
                    border: 2px solid #ddd;
                    border-radius: 8px;
                    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
                    z-index: 10000;
                    padding: 10px;
                    display: flex;
                    flex-direction: column;
                    gap: 8px;
                `;
                
                menu.innerHTML = `
                    <button onclick="sosSystem.showHospitalModal(); document.body.removeChild(this.parentElement);" class="control-btn success" style="margin: 0; min-width: 150px;">
                        <i class="fas fa-plus"></i>
                        –°—Ç–≤–æ—Ä–∏—Ç–∏ –ª—ñ–∫–∞—Ä–Ω—é
                    </button>
                    <button onclick="sosSystem.showHospitalsList(); document.body.removeChild(this.parentElement);" class="control-btn secondary" style="margin: 0; min-width: 150px;">
                        <i class="fas fa-list"></i>
                        –°–ø–∏—Å–æ–∫ –ª—ñ–∫–∞—Ä–µ–Ω—å
                    </button>
                `;
                
                document.body.appendChild(menu);
                
                setTimeout(() => {
                    document.addEventListener('click', function closeMenu(e) {
                        if (!menu.contains(e.target) && !document.getElementById('hospitalBtn').contains(e.target)) {
                            if (menu.parentElement) document.body.removeChild(menu);
                            document.removeEventListener('click', closeMenu);
                        }
                    });
                }, 100);
            }
            
            showHospitalModal() {
                document.getElementById('hospitalModal').classList.add('active');
                setTimeout(() => this.initMiniMap(), 100);
            }
            
            closeHospitalModal() {
                document.getElementById('hospitalModal').classList.remove('active');
                if (this.miniMap) {
                    this.miniMap.remove();
                    this.miniMap = null;
                }
            }
            
            initMiniMap() {
                if (this.miniMap) this.miniMap.remove();
                
                const currentLat = parseFloat(document.getElementById('hospitalLat').value) || 49.9935;
                const currentLng = parseFloat(document.getElementById('hospitalLng').value) || 36.2304;
                
                this.miniMap = L.map('miniMap').setView([currentLat, currentLng], 12);
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(this.miniMap);
                
                // –ü–æ–∫–∞–∑–∞—Ç–∏ –ø–æ—Ç–æ—á–Ω—É –ø–æ–∑–∏—Ü—ñ—é
                if (document.getElementById('hospitalLat').value && document.getElementById('hospitalLng').value) {
                    this.tempMarker = L.marker([currentLat, currentLng]).addTo(this.miniMap);
                }
                
                this.miniMap.on('click', (e) => {
                    document.getElementById('hospitalLat').value = e.latlng.lat.toFixed(6);
                    document.getElementById('hospitalLng').value = e.latlng.lng.toFixed(6);
                    
                    if (this.tempMarker) this.miniMap.removeLayer(this.tempMarker);
                    this.tempMarker = L.marker([e.latlng.lat, e.latlng.lng]).addTo(this.miniMap);
                });
                
                // –û–±—Ä–æ–±–∫–∞ —Ä—É—á–Ω–æ–≥–æ –≤–≤–µ–¥–µ–Ω–Ω—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
                ['hospitalLat', 'hospitalLng'].forEach(id => {
                    document.getElementById(id).addEventListener('input', () => {
                        const lat = parseFloat(document.getElementById('hospitalLat').value);
                        const lng = parseFloat(document.getElementById('hospitalLng').value);
                        if (lat && lng && lat >= -90 && lat <= 90 && lng >= -180 && lng <= 180) {
                            if (this.tempMarker) this.miniMap.removeLayer(this.tempMarker);
                            this.tempMarker = L.marker([lat, lng]).addTo(this.miniMap);
                            this.miniMap.setView([lat, lng], 12);
                        }
                    });
                });
            }
            
            saveHospital() {
                const hospitalData = {
                    name: document.getElementById('hospitalName').value,
                    address: document.getElementById('hospitalAddress').value,
                    contactPerson: document.getElementById('contactPerson').value,
                    emergencyPhone: document.getElementById('emergencyPhone').value,
                    lat: parseFloat(document.getElementById('hospitalLat').value),
                    lng: parseFloat(document.getElementById('hospitalLng').value),
                    staff: [...this.hospitalStaff]
                };
                
                if (!hospitalData.name || !hospitalData.lat || !hospitalData.lng) {
                    this.showNotification('–ó–∞–ø–æ–≤–Ω—ñ—Ç—å –Ω–∞–∑–≤—É —Ç–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏', 'error');
                    return;
                }
                
                if (this.editingHospitalIndex !== undefined) {
                    // –†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è —ñ—Å–Ω—É—é—á–æ—ó –ª—ñ–∫–∞—Ä–Ω—ñ
                    Object.assign(this.hospitals[this.editingHospitalIndex], hospitalData);
                    this.showNotification('–õ—ñ–∫–∞—Ä–Ω—é –æ–Ω–æ–≤–ª–µ–Ω–æ');
                } else {
                    // –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ω–æ–≤–æ—ó –ª—ñ–∫–∞—Ä–Ω—ñ
                    const newHospital = {
                        id: Date.now(),
                        ...hospitalData,
                        draggable: true
                    };
                    this.hospitals.push(newHospital);
                    this.showNotification('–õ—ñ–∫–∞—Ä–Ω—é –¥–æ–¥–∞–Ω–æ');
                }
                
                this.saveLocations();
                this.refreshHospitalMarkers();
                this.clearHospitalForm();
                this.closeHospitalModal();
            }
            
            addHospitalMarker(hospital) {
                const icon = L.divIcon({ html: '<div class="marker-hospital"></div>', className: 'custom-marker', iconSize: [18, 18], iconAnchor: [9, 9] });
                
                let popupContent = `<strong>${hospital.name}</strong><br>`;
                popupContent += `${hospital.address}<br>`;
                if (hospital.contactPerson) popupContent += `–ö–æ–Ω—Ç–∞–∫—Ç: ${hospital.contactPerson}<br>`;
                if (hospital.emergencyPhone) popupContent += `–ü—Ä–∏–π–º–∞–ª—å–Ω–µ: ${hospital.emergencyPhone}<br>`;
                popupContent += `–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏: ${hospital.lat.toFixed(6)}, ${hospital.lng.toFixed(6)}<br>`;
                popupContent += `<div style="margin-top: 8px; display: flex; gap: 5px;">`;
                popupContent += `<button onclick="navigator.clipboard.writeText('${hospital.lat.toFixed(6)}, ${hospital.lng.toFixed(6)}'); sosSystem.showNotification('–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ')" style="background: #1976d2; color: white; border: none; padding: 6px 10px; border-radius: 4px; cursor: pointer; font-size: 12px;">üìã</button>`;
                popupContent += `<button onclick="window.open('https://www.google.com/maps?q=${hospital.lat},${hospital.lng}', '_blank')" style="background: #4CAF50; color: white; border: none; padding: 6px 10px; border-radius: 4px; cursor: pointer; font-size: 12px;">üó∫Ô∏è</button>`;
                popupContent += `</div>`;
                if (hospital.staff.length > 0) {
                    popupContent += `<br><strong>–ü–µ—Ä—Å–æ–Ω–∞–ª:</strong><br>`;
                    hospital.staff.forEach(staff => {
                        popupContent += `${staff.name} - ${staff.position}<br>`;
                        if (staff.schedule) popupContent += `–ì—Ä–∞—Ñ—ñ–∫: ${staff.schedule}<br>`;
                        if (staff.phone) popupContent += `–¢–µ–ª: ${staff.phone}<br>`;
                    });
                }
                
                L.marker([hospital.lat, hospital.lng], { icon })
                    .bindPopup(popupContent)
                    .addTo(this.map);
            }
            
            clearHospitalForm() {
                document.getElementById('hospitalForm').reset();
                this.hospitalStaff = [];
                this.updateStaffList();
                this.selectedCoords = null;
                this.editingHospitalIndex = undefined;
                if (this.tempMarker && this.miniMap) {
                    this.miniMap.removeLayer(this.tempMarker);
                }
            }
            
            routeToSOS(sosLat, sosLng) {
                if (!this.userLocation) {
                    this.showNotification('–ú—ñ—Å—Ü–µ–∑–Ω–∞—Ö–æ–¥–∂–µ–Ω–Ω—è –Ω–µ –≤–∏–∑–Ω–∞—á–µ–Ω–æ', 'error');
                    return;
                }
                
                this.clearRoutes();
                const userRoute = L.Routing.control({
                    waypoints: [L.latLng(this.userLocation.lat, this.userLocation.lng), L.latLng(sosLat, sosLng)],
                    routeWhileDragging: false, addWaypoints: false, createMarker: () => null, show: false,
                    lineOptions: { styles: [{ color: '#FF5722', weight: 6, opacity: 0.8 }] }
                }).addTo(this.map);
                this.routeControls.push(userRoute);
                this.showNotification('üìç –ú–∞—Ä—à—Ä—É—Ç –ø–æ–±—É–¥–æ–≤–∞–Ω–æ');
            }
            
            findNearestHospitalForGroup(groupId) {
                // –ü–æ—à—É–∫ –Ω–∞–π–±–ª–∏–∂—á–æ—ó –ª—ñ–∫–∞—Ä–Ω—ñ –¥–ª—è –≥—Ä—É–ø–∏ —Ç–∞ –ø–æ–±—É–¥–æ–≤–∞ –º–∞—Ä—à—Ä—É—Ç—É
                const group = this.groups.find(g => g.id === groupId);
                if (!group) return;
                
                const groupPos = [group.lat, group.lng];
                const nearestHospital = this.findNearestHospital(groupPos);  // –ó–Ω–∞—Ö–æ–¥–∏–º–æ –Ω–∞–π–±–ª–∏–∂—á—É –ª—ñ–∫–∞—Ä–Ω—é
                
                if (!nearestHospital) {
                    this.showNotification('–õ—ñ–∫–∞—Ä–µ–Ω—å –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ', 'error');
                    return;
                }
                
                // –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –≤—ñ–¥—Å—Ç–∞–Ω—ñ –≤ –∫—ñ–ª–æ–º–µ—Ç—Ä–∞—Ö
                const distance = (this.calculateDistance(groupPos, [nearestHospital.lat, nearestHospital.lng]) * 111).toFixed(1);
                
                // –î—ñ–∞–ª–æ–≥ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –∑ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—î—é –ø—Ä–æ –ª—ñ–∫–∞—Ä–Ω—é
                if (confirm(`–ù–∞–π–±–ª–∏–∂—á–∞ –ª—ñ–∫–∞—Ä–Ω—è: ${nearestHospital.name}\n–í—ñ–¥—Å—Ç–∞–Ω—å: ${distance} –∫–º\n\n–ü–æ–±—É–¥—É–≤–∞—Ç–∏ –º–∞—Ä—à—Ä—É—Ç?`)) {
                    this.clearRoutes();              // –û—á–∏—â—É—î–º–æ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ –º–∞—Ä—à—Ä—É—Ç–∏
                    
                    // –°—Ç–≤–æ—Ä—é—î–º–æ –º–∞—Ä—à—Ä—É—Ç –ø–æ–º–∞—Ä–∞–Ω—á–µ–≤–æ—é –ª—ñ–Ω—ñ—î—é
                    const hospitalRoute = L.Routing.control({
                        waypoints: [L.latLng(groupPos[0], groupPos[1]), L.latLng(nearestHospital.lat, nearestHospital.lng)],
                        routeWhileDragging: false, addWaypoints: false, createMarker: () => null, show: false,
                        lineOptions: { styles: [{ color: '#FF9800', weight: 6, opacity: 0.8 }] }
                    }).addTo(this.map);
                    this.routeControls.push(hospitalRoute);
                    this.showNotification(`üè• –ú–∞—Ä—à—Ä—É—Ç –¥–æ ${nearestHospital.name} –ø–æ–±—É–¥–æ–≤–∞–Ω–æ`);
                }
            }
            
            showHospitalsList() {
                const modal = document.createElement('div');
                modal.className = 'modal-overlay active';
                
                let listContent = '<h3>–°–ø–∏—Å–æ–∫ –ª—ñ–∫–∞—Ä–µ–Ω—å</h3><div style="max-height: 300px; overflow-y: auto;">';
                
                if (this.hospitals.length === 0) {
                    listContent += '<p>–õ—ñ–∫–∞—Ä–µ–Ω—å –Ω–µ –¥–æ–¥–∞–Ω–æ</p>';
                } else {
                    this.hospitals.forEach((hospital, index) => {
                        listContent += `
                            <div style="border: 1px solid #ddd; border-radius: 5px; padding: 10px; margin: 5px 0;">
                                <strong>${hospital.name}</strong><br>
                                ${hospital.address || '–ê–¥—Ä–µ—Å–∞ –Ω–µ –≤–∫–∞–∑–∞–Ω–∞'}<br>
                                ${hospital.contactPerson ? '–ö–æ–Ω—Ç–∞–∫—Ç: ' + hospital.contactPerson + '<br>' : ''}
                                ${hospital.emergencyPhone ? '–¢–µ–ª: ' + hospital.emergencyPhone + '<br>' : ''}
                                <button onclick="window.sosSystem.goToHospital(${index}); document.body.removeChild(document.querySelector('.modal-overlay'));" class="btn-sm btn-primary">–ü–µ—Ä–µ–π—Ç–∏</button>
                                <button onclick="window.sosSystem.editHospital(${index});" class="btn-sm btn-warning" style="margin-left: 5px;">–†–µ–¥–∞–≥—É–≤–∞—Ç–∏</button>
                                <button onclick="window.sosSystem.deleteHospitalById(${hospital.id});" class="btn-sm btn-danger" style="margin-left: 5px;">–í–∏–¥–∞–ª–∏—Ç–∏</button>
                            </div>
                        `;
                    });
                }
                
                listContent += '</div>';
                
                modal.innerHTML = `
                    <div class="modal-content">
                        ${listContent}
                        <button onclick="document.body.removeChild(this.closest('.modal-overlay'))" style="position: absolute; top: 15px; right: 15px; background: none; border: none; font-size: 20px; cursor: pointer;">√ó</button>
                    </div>
                `;
                
                document.body.appendChild(modal);
            }
            
            editHospital(index) {
                const hospital = this.hospitals[index];
                document.getElementById('hospitalName').value = hospital.name || '';
                document.getElementById('hospitalAddress').value = hospital.address || '';
                document.getElementById('contactPerson').value = hospital.contactPerson || '';
                document.getElementById('emergencyPhone').value = hospital.emergencyPhone || '';
                document.getElementById('hospitalLat').value = hospital.lat || '';
                document.getElementById('hospitalLng').value = hospital.lng || '';
                this.hospitalStaff = [...(hospital.staff || [])];
                this.updateStaffList();
                this.editingHospitalIndex = index;
                const modal = document.querySelector('.modal-overlay');
                if (modal) document.body.removeChild(modal);
                this.showHospitalModal();
            }
            
            deleteHospital(index) {
                if (confirm('–í–∏–¥–∞–ª–∏—Ç–∏ –ª—ñ–∫–∞—Ä–Ω—é?')) {
                    this.hospitals.splice(index, 1);
                    this.refreshHospitalMarkers();
                    const modal = document.querySelector('.modal-overlay');
                    if (modal) document.body.removeChild(modal);
                    this.showNotification('–õ—ñ–∫–∞—Ä–Ω—é –≤–∏–¥–∞–ª–µ–Ω–æ');
                }
            }
            
            goToHospital(index) {
                const hospital = this.hospitals[index];
                this.map.setView([hospital.lat, hospital.lng], 16, { animate: true, duration: 1.5 });
            }
            
            refreshHospitalMarkers() {
                // –í–∏–¥–∞–ª—è—î–º–æ –≤—Å—ñ –º–∞—Ä–∫–µ—Ä–∏ –ª—ñ–∫–∞—Ä–µ–Ω—å
                if (this.hospitalMarkers) {
                    this.hospitalMarkers.forEach(({ marker }) => {
                        this.map.removeLayer(marker);
                    });
                }
                // –î–æ–¥–∞—î–º–æ –º–∞—Ä–∫–µ—Ä–∏ –∑–Ω–æ–≤—É
                this.addHospitalMarkers();
            }
            
            editHospitalFromMap(hospitalId) {
                const hospital = this.hospitals.find(h => h.id === hospitalId);
                if (!hospital) return;
                
                document.getElementById('hospitalName').value = hospital.name;
                document.getElementById('hospitalAddress').value = hospital.address || '';
                document.getElementById('contactPerson').value = hospital.contactPerson || '';
                document.getElementById('emergencyPhone').value = hospital.emergencyPhone || '';
                document.getElementById('hospitalLat').value = hospital.lat;
                document.getElementById('hospitalLng').value = hospital.lng;
                
                this.hospitalStaff = [...(hospital.staff || [])];
                this.updateStaffList();
                this.editingHospitalIndex = this.hospitals.findIndex(h => h.id === hospitalId);
                this.showHospitalModal();
            }
            
            deleteHospital(hospitalId) {
                if (confirm('–í–∏–¥–∞–ª–∏—Ç–∏ –ª—ñ–∫–∞—Ä–Ω—é?')) {
                    this.hospitals = this.hospitals.filter(h => h.id !== hospitalId);
                    this.saveLocations();
                    this.refreshHospitalMarkers();
                    this.showNotification('–õ—ñ–∫–∞—Ä–Ω—é –≤–∏–¥–∞–ª–µ–Ω–æ');
                }
            }
            
            showGroupMenu() {
                const menu = document.createElement('div');
                menu.style.cssText = `
                    position: fixed;
                    bottom: 80px;
                    left: 20px;
                    background: white;
                    border: 2px solid #ddd;
                    border-radius: 8px;
                    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
                    z-index: 10000;
                    padding: 10px;
                    display: flex;
                    flex-direction: column;
                    gap: 8px;
                `;
                
                menu.innerHTML = `
                    <button onclick="sosSystem.showGroupModal(); document.body.removeChild(this.parentElement);" class="control-btn primary" style="margin: 0; min-width: 150px;">
                        <i class="fas fa-plus"></i>
                        –°—Ç–≤–æ—Ä–∏—Ç–∏ –≥—Ä—É–ø—É
                    </button>
                    <button onclick="sosSystem.showGroupsList(); document.body.removeChild(this.parentElement);" class="control-btn secondary" style="margin: 0; min-width: 150px;">
                        <i class="fas fa-list"></i>
                        –°–ø–∏—Å–æ–∫ –≥—Ä—É–ø
                    </button>
                `;
                
                document.body.appendChild(menu);
                
                setTimeout(() => {
                    document.addEventListener('click', function closeMenu(e) {
                        if (!menu.contains(e.target) && !document.getElementById('groupBtn').contains(e.target)) {
                            if (menu.parentElement) document.body.removeChild(menu);
                            document.removeEventListener('click', closeMenu);
                        }
                    });
                }, 100);
            }
            
            showGroupModal() {
                document.getElementById('groupModal').classList.add('active');
                setTimeout(() => this.initGroupMiniMap(), 100);
            }
            
            closeGroupModal() {
                document.getElementById('groupModal').classList.remove('active');
                if (this.groupMiniMap) {
                    this.groupMiniMap.remove();
                    this.groupMiniMap = null;
                }
            }
            
            initGroupMiniMap() {
                if (this.groupMiniMap) this.groupMiniMap.remove();
                
                const currentLat = parseFloat(document.getElementById('groupLat').value) || 49.9935;
                const currentLng = parseFloat(document.getElementById('groupLng').value) || 36.2304;
                
                this.groupMiniMap = L.map('groupMiniMap').setView([currentLat, currentLng], 10);
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(this.groupMiniMap);
                
                // –ü–æ–∫–∞–∑–∞—Ç–∏ –ø–æ—Ç–æ—á–Ω—É –ø–æ–∑–∏—Ü—ñ—é
                if (document.getElementById('groupLat').value && document.getElementById('groupLng').value) {
                    this.tempGroupMarker = L.marker([currentLat, currentLng]).addTo(this.groupMiniMap);
                }
                
                this.groupMiniMap.on('click', (e) => {
                    document.getElementById('groupLat').value = e.latlng.lat.toFixed(6);
                    document.getElementById('groupLng').value = e.latlng.lng.toFixed(6);
                    
                    if (this.tempGroupMarker) this.groupMiniMap.removeLayer(this.tempGroupMarker);
                    this.tempGroupMarker = L.marker([e.latlng.lat, e.latlng.lng]).addTo(this.groupMiniMap);
                });
                
                // –û–±—Ä–æ–±–∫–∞ —Ä—É—á–Ω–æ–≥–æ –≤–≤–µ–¥–µ–Ω–Ω—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
                ['groupLat', 'groupLng'].forEach(id => {
                    document.getElementById(id).addEventListener('input', () => {
                        const lat = parseFloat(document.getElementById('groupLat').value);
                        const lng = parseFloat(document.getElementById('groupLng').value);
                        if (lat && lng && lat >= -90 && lat <= 90 && lng >= -180 && lng <= 180) {
                            if (this.tempGroupMarker) this.groupMiniMap.removeLayer(this.tempGroupMarker);
                            this.tempGroupMarker = L.marker([lat, lng]).addTo(this.groupMiniMap);
                            this.groupMiniMap.setView([lat, lng], 12);
                        }
                    });
                });
            }
            
            saveGroup() {
                const groupData = {
                    name: document.getElementById('groupName').value,
                    type: document.getElementById('groupType').value,
                    personnel: parseInt(document.getElementById('groupPersonnel').value),
                    lat: parseFloat(document.getElementById('groupLat').value),
                    lng: parseFloat(document.getElementById('groupLng').value)
                };
                
                if (!groupData.name || !groupData.personnel || !groupData.lat || !groupData.lng) {
                    this.showNotification('–ó–∞–ø–æ–≤–Ω—ñ—Ç—å –≤—Å—ñ –æ–±–æ–≤\'\u044f–∑–∫–æ–≤—ñ –ø–æ–ª—è —Ç–∞ –æ–±–µ—Ä—ñ—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏', 'error');
                    return;
                }
                
                if (this.editingGroupIndex !== undefined) {
                    // –†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è —ñ—Å–Ω—É—é—á–æ—ó –≥—Ä—É–ø–∏
                    Object.assign(this.groups[this.editingGroupIndex], groupData);
                    this.editingGroupIndex = undefined;
                    this.showNotification('–ì—Ä—É–ø—É –æ–Ω–æ–≤–ª–µ–Ω–æ');
                } else {
                    // –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ω–æ–≤–æ—ó –≥—Ä—É–ø–∏
                    const newGroup = {
                        id: Date.now(),
                        ...groupData,
                        active: false,
                        timestamp: new Date().toLocaleString('uk-UA')
                    };
                    this.groups.push(newGroup);
                    this.showNotification('–ì—Ä—É–ø—É –¥–æ–¥–∞–Ω–æ');
                }
                
                this.saveLocations();
                this.refreshGroupMarkers();
                this.clearGroupForm();
                this.closeGroupModal();
            }
            
            clearGroupForm() {
                document.getElementById('groupForm').reset();
                this.selectedGroupCoords = null;
                this.editingGroupIndex = undefined;
                if (this.tempGroupMarker && this.groupMiniMap) {
                    this.groupMiniMap.removeLayer(this.tempGroupMarker);
                }
            }
            
            showGroupsList() {
                const modal = document.createElement('div');
                modal.className = 'modal-overlay active';
                
                let listContent = '<h3>–°–ø–∏—Å–æ–∫ –≥—Ä—É–ø</h3><div style="max-height: 300px; overflow-y: auto;">';
                
                if (this.groups.length === 0) {
                    listContent += '<p>–ì—Ä—É–ø –Ω–µ –¥–æ–¥–∞–Ω–æ</p>';
                } else {
                    this.groups.forEach((group, index) => {
                        listContent += `
                            <div style="border: 1px solid #ddd; border-radius: 5px; padding: 10px; margin: 5px 0;">
                                <strong>${group.name}</strong> - ${group.type}<br>
                                –û—Å–æ–±–æ–≤–∏–π —Å–∫–ª–∞–¥: ${group.personnel}<br>
                                –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏: ${group.lat.toFixed(4)}, ${group.lng.toFixed(4)}<br>
                                <button onclick="window.sosSystem.goToGroup(${index}); document.body.removeChild(document.querySelector('.modal-overlay'));" class="btn-sm btn-primary">–ü–µ—Ä–µ–π—Ç–∏</button>
                                <button onclick="window.sosSystem.editGroup(${index});" class="btn-sm btn-warning" style="margin-left: 5px;">–†–µ–¥–∞–≥—É–≤–∞—Ç–∏</button>
                                <button onclick="window.sosSystem.deleteGroupById(${group.id});" class="btn-sm btn-danger" style="margin-left: 5px;">–í–∏–¥–∞–ª–∏—Ç–∏</button>
                            </div>
                        `;
                    });
                }
                
                listContent += '</div>';
                
                modal.innerHTML = `
                    <div class="modal-content">
                        ${listContent}
                        <button onclick="document.body.removeChild(this.closest('.modal-overlay'))" style="position: absolute; top: 15px; right: 15px; background: none; border: none; font-size: 20px; cursor: pointer;">√ó</button>
                    </div>
                `;
                
                document.body.appendChild(modal);
            }
            
            editGroup(index) {
                const group = this.groups[index];
                document.getElementById('groupName').value = group.name || '';
                document.getElementById('groupType').value = group.type || '–ù–¢–û';
                document.getElementById('groupPersonnel').value = group.personnel || '';
                document.getElementById('groupLat').value = group.lat || '';
                document.getElementById('groupLng').value = group.lng || '';
                this.editingGroupIndex = index;
                const modal = document.querySelector('.modal-overlay');
                if (modal) document.body.removeChild(modal);
                this.showGroupModal();
            }
            
            deleteGroup(index) {
                if (confirm('–í–∏–¥–∞–ª–∏—Ç–∏ –≥—Ä—É–ø—É?')) {
                    this.groups.splice(index, 1);
                    this.saveLocations();
                    this.refreshGroupMarkers();
                    const modal = document.querySelector('.modal-overlay');
                    if (modal) document.body.removeChild(modal);
                    this.showNotification('–ì—Ä—É–ø—É –≤–∏–¥–∞–ª–µ–Ω–æ');
                }
            }
            
            deleteHospitalById(hospitalId) {
                if (confirm('–í–∏–¥–∞–ª–∏—Ç–∏ –ª—ñ–∫–∞—Ä–Ω—é?')) {
                    this.hospitals = this.hospitals.filter(h => h.id !== hospitalId);
                    this.saveLocations();
                    this.refreshHospitalMarkers();
                    const modal = document.querySelector('.modal-overlay');
                    if (modal) document.body.removeChild(modal);
                    this.showNotification('–õ—ñ–∫–∞—Ä–Ω—é –≤–∏–¥–∞–ª–µ–Ω–æ');
                }
            }
            
            deleteGroupById(groupId) {
                if (confirm('–í–∏–¥–∞–ª–∏—Ç–∏ –≥—Ä—É–ø—É?')) {
                    this.groups = this.groups.filter(g => g.id !== groupId);
                    this.saveLocations();
                    this.refreshGroupMarkers();
                    const modal = document.querySelector('.modal-overlay');
                    if (modal) document.body.removeChild(modal);
                    this.showNotification('–ì—Ä—É–ø—É –≤–∏–¥–∞–ª–µ–Ω–æ');
                }
            }
            
            goToGroup(index) {
                const group = this.groups[index];
                this.map.setView([group.lat, group.lng], 16, { animate: true, duration: 1.5 });
            }
            
            refreshGroupMarkers() {
                this.groupMarkers.forEach(({ marker }) => {
                    this.map.removeLayer(marker);
                });
                this.groupMarkers = [];
                this.addGroupMarkers();
            }
            
            editGroupFromMap(groupId) {
                const group = this.groups.find(g => g.id === groupId);
                if (!group) return;
                
                document.getElementById('groupName').value = group.name;
                document.getElementById('groupType').value = group.type;
                document.getElementById('groupPersonnel').value = group.personnel;
                document.getElementById('groupLat').value = group.lat;
                document.getElementById('groupLng').value = group.lng;
                
                this.editingGroupIndex = this.groups.findIndex(g => g.id === groupId);
                this.showGroupModal();
            }
            

            
            showDataMenu() {
                const menu = document.createElement('div');
                menu.style.cssText = `
                    position: fixed;
                    bottom: 80px;
                    left: 20px;
                    background: white;
                    border: 2px solid #ddd;
                    border-radius: 8px;
                    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
                    z-index: 10000;
                    padding: 10px;
                    display: flex;
                    flex-direction: column;
                    gap: 8px;
                `;
                
                menu.innerHTML = `
                    <button onclick="sosSystem.exportData(); document.body.removeChild(this.parentElement);" class="control-btn" style="margin: 0; min-width: 150px; background: #4CAF50;">
                        <i class="fas fa-download"></i>
                        –ï–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–∏—Ö
                    </button>
                    <button onclick="sosSystem.importData(); document.body.removeChild(this.parentElement);" class="control-btn" style="margin: 0; min-width: 150px; background: #FF9800;">
                        <i class="fas fa-upload"></i>
                        –Ü–º–ø–æ—Ä—Ç –¥–∞–Ω–∏—Ö
                    </button>
                    <button onclick="sosSystem.resetData(); document.body.removeChild(this.parentElement);" class="control-btn" style="margin: 0; min-width: 150px; background: #f44336;">
                        <i class="fas fa-refresh"></i>
                        –°–∫–∏–Ω—É—Ç–∏ –¥–∞–Ω—ñ
                    </button>
                `;
                
                document.body.appendChild(menu);
                
                setTimeout(() => {
                    document.addEventListener('click', function closeMenu(e) {
                        if (!menu.contains(e.target) && !document.getElementById('dataBtn').contains(e.target)) {
                            if (menu.parentElement) document.body.removeChild(menu);
                            document.removeEventListener('click', closeMenu);
                        }
                    });
                }, 100);
            }
            
            exportData() {
                const data = {
                    groups: this.groups,
                    hospitals: this.hospitals,
                    exported: new Date().toISOString()
                };
                
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `sos-locations-${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                URL.revokeObjectURL(url);
                
                this.showNotification('–î–∞–Ω—ñ –µ–∫—Å–ø–æ—Ä—Ç–æ–≤–∞–Ω–æ');
            }
            
            importData() {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = '.json';
                input.onchange = (e) => {
                    const file = e.target.files[0];
                    if (!file) return;
                    
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        try {
                            const data = JSON.parse(e.target.result);
                            if (data.groups && data.hospitals) {
                                this.groups = data.groups;
                                this.hospitals = data.hospitals;
                                this.saveLocations();
                                this.refreshGroupMarkers();
                                this.refreshHospitalMarkers();
                                this.showNotification('–î–∞–Ω—ñ —ñ–º–ø–æ—Ä—Ç–æ–≤–∞–Ω–æ');
                            } else {
                                this.showNotification('–ù–µ–≤—ñ—Ä–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª—É', 'error');
                            }
                        } catch (error) {
                            this.showNotification('–ü–æ–º–∏–ª–∫–∞ —á–∏—Ç–∞–Ω–Ω—è —Ñ–∞–π–ª—É', 'error');
                        }
                    };
                    reader.readAsText(file);
                };
                input.click();
            }
            
            resetData() {
                if (confirm('–°–∫–∏–Ω—É—Ç–∏ –≤—Å—ñ –¥–∞–Ω—ñ –¥–æ –ø–æ—á–∞—Ç–∫–æ–≤–∏—Ö –∑–Ω–∞—á–µ–Ω—å?')) {
                    this.groups = this.generateDefaultGroups();
                    this.hospitals = this.generateDefaultHospitals();
                    this.saveLocations();
                    this.refreshGroupMarkers();
                    this.refreshHospitalMarkers();
                    this.showNotification('–î–∞–Ω—ñ —Å–∫–∏–Ω—É—Ç–æ');
                }
            }
        }
        
        // –ì–ª–æ–±–∞–ª—å–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó –¥–ª—è –≤–∏–∫–ª–∏–∫—É –∑ HTML
        function showAddGroupModal() { sosSystem.showAddGroupModal(); }
        function closeAddGroupModal() { sosSystem.closeAddGroupModal(); }
        function closeIncidentsPanel() { sosSystem.closeIncidentsPanel(); }
        function closeLogsModal() { sosSystem.closeLogsModal(); }
        function closeVictimModal() { sosSystem.closeVictimModal(); }
        function stopAllSOS() { sosSystem.stopAllSOS(); }
        function addLog() { sosSystem.addLog(); }
        function clearVictimForm() { sosSystem.clearVictimForm(); }
        function closeHospitalModal() { sosSystem.closeHospitalModal(); }
        function clearHospitalForm() { sosSystem.clearHospitalForm(); }
        function closeGroupModal() { sosSystem.closeGroupModal(); }
        function clearGroupForm() { sosSystem.clearGroupForm(); }
        
        function addStaff() {
            const name = document.getElementById('staffName').value.trim();
            const position = document.getElementById('staffPosition').value.trim();
            const schedule = document.getElementById('staffSchedule').value.trim();
            const phone = document.getElementById('staffPhone').value.trim();
            
            if (!name || !position) {
                sosSystem.showNotification('–ó–∞–ø–æ–≤–Ω—ñ—Ç—å –ü–Ü–ë —Ç–∞ –ø–æ—Å–∞–¥—É', 'error');
                return;
            }
            
            sosSystem.hospitalStaff.push({ name, position, schedule, phone });
            
            document.getElementById('staffName').value = '';
            document.getElementById('staffPosition').value = '';
            document.getElementById('staffSchedule').value = '';
            document.getElementById('staffPhone').value = '';
            
            updateStaffList();
        }
        
        function updateStaffList() {
            const list = document.getElementById('staffList');
            list.innerHTML = '';
            
            sosSystem.hospitalStaff.forEach((staff, index) => {
                const item = document.createElement('div');
                item.className = 'staff-item';
                item.innerHTML = `
                    <div>
                        <strong>${staff.name}</strong> - ${staff.position}<br>
                        <small>${staff.schedule || '–ì—Ä–∞—Ñ—ñ–∫ –Ω–µ –≤–∫–∞–∑–∞–Ω–æ'} | ${staff.phone || '–¢–µ–ª. –Ω–µ –≤–∫–∞–∑–∞–Ω–æ'}</small>
                    </div>
                    <button onclick="removeStaff(${index})" class="btn-sm btn-danger">
                        <i class="fas fa-trash"></i>
                    </button>
                `;
                list.appendChild(item);
            });
        }
        
        function removeStaff(index) {
            sosSystem.hospitalStaff.splice(index, 1);
            updateStaffList();
        }
        

        
        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è —Å–∏—Å—Ç–µ–º–∏ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏
        let sosSystem;
        document.addEventListener('DOMContentLoaded', async () => {
            sosSystem = new SOSSystem();         // –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –µ–∫–∑–µ–º–ø–ª—è—Ä—É —Å–∏—Å—Ç–µ–º–∏
            await sosSystem.init();              // –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è
            window.sosSystem = sosSystem;        // –ì–ª–æ–±–∞–ª—å–Ω–∏–π –¥–æ—Å—Ç—É–ø –¥–ª—è HTML
            console.log('üÜò SOS System initialized by Illia Usachov');
        });
    </script>
    
    <!-- 
        üÜò SOS Emergency System

        by Illia Usachov

    -->
</body>
</html>
